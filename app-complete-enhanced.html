<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุทุจูู ุขู ุณุนูุฏุงู ุงูุดุงูู - ูุน ุงูุฃุฌูุงู ุงููุชุฑุงุจุทุฉ</title>
    
    <!-- CSS Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet" />
    
    <!-- Arabic Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Chart.js for Statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { 
            font-family: 'Noto Sans Arabic', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        .card:hover {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .modal { backdrop-filter: blur(5px); }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #059669);
            transform: translateY(-1px);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show { transform: translateX(0); }
        .toast.success { background: linear-gradient(135deg, #10b981, #059669); }
        .toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }

        /* ุชุตููู ุงูุดุฌุฑุฉ ุงูุนุงุฆููุฉ ุงููุญุณู */
        .generation {
            margin-bottom: 40px;
            border-left: 4px solid #3b82f6;
            padding-left: 25px;
            position: relative;
        }
        
        .generation::before {
            content: '';
            position: absolute;
            left: -2px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3b82f6, #10b981);
        }
        
        .generation-header {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .member-card {
            margin: 15px 0;
            border-right: 3px solid #10b981;
            padding-right: 20px;
            position: relative;
        }
        
        .founder-card {
            border-right: 3px solid #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(59, 130, 246, 0.05));
        }
        
        .connection-line {
            border-left: 2px dashed #cbd5e1;
            margin-right: 25px;
            padding-left: 25px;
            position: relative;
        }
        
        .connection-line::before {
            content: 'โณ';
            position: absolute;
            left: -15px;
            top: 20px;
            color: #3b82f6;
            font-size: 18px;
            font-weight: bold;
        }

        .member-actions {
            position: absolute;
            top: 15px;
            left: 15px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .member-card:hover .member-actions {
            opacity: 1;
        }
        
        .edit-btn, .delete-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 8px;
            margin: 2px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .edit-btn:hover { background: #3b82f6; color: white; }
        .delete-btn:hover { background: #ef4444; color: white; }

        /* ุชุญุณูู ุงูุฅุญุตุงุฆูุงุช */
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-800 ml-4">
                        <i class="fas fa-home text-blue-600 ml-2"></i>
                        ุชุทุจูู ุขู ุณุนูุฏุงู ุงูุดุงูู
                    </h1>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-8 rtl:space-x-reverse">
                    <button id="nav-home" class="nav-item active px-4 py-2 rounded-lg transition" onclick="showSection('home')">
                        <i class="fas fa-home ml-2"></i>ุงูุฑุฆูุณูุฉ
                    </button>
                    <button id="nav-family" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('family')">
                        <i class="fas fa-users ml-2"></i>ุงูุดุฌุฑุฉ ุงูุนุงุฆููุฉ
                    </button>
                    <button id="nav-events" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('events')">
                        <i class="fas fa-calendar ml-2"></i>ุงูุฃุญุฏุงุซ
                    </button>
                    <button id="nav-suggestions" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('suggestions')">
                        <i class="fas fa-lightbulb ml-2"></i>ุงูุงูุชุฑุงุญุงุช
                    </button>
                    <button id="nav-library" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('library')">
                        <i class="fas fa-book ml-2"></i>ุงูููุชุจุฉ ุงูุฑูููุฉ
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sync Status Bar -->
    <div class="bg-blue-50 border-b border-blue-200">
        <div class="max-w-7xl mx-auto px-4 py-2">
            <div id="syncStatus" class="text-center text-blue-700">
                <span class="font-medium">๐ ุชุทุจูู ุขู ุณุนูุฏุงู ุงูุดุงูู - ูุน ุงูุฃุฌูุงู ุงููุชุฑุงุจุทุฉ</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Home Section -->
        <section id="home-section" class="section active">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Statistics Cards -->
                <div class="stat-card">
                    <i class="fas fa-users stat-icon text-blue-600"></i>
                    <div class="stat-number text-blue-600" id="total-members">0</div>
                    <p class="text-gray-600 font-medium">ุฃุนุถุงุก ุงูุนุงุฆูุฉ</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-alt stat-icon text-green-600"></i>
                    <div class="stat-number text-green-600" id="total-events">0</div>
                    <p class="text-gray-600 font-medium">ุงูุฃุญุฏุงุซ</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-lightbulb stat-icon text-yellow-600"></i>
                    <div class="stat-number text-yellow-600" id="total-suggestions">0</div>
                    <p class="text-gray-600 font-medium">ุงูุงูุชุฑุงุญุงุช</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-book stat-icon text-purple-600"></i>
                    <div class="stat-number text-purple-600" id="total-library">0</div>
                    <p class="text-gray-600 font-medium">ุงูููุชุจุฉ ุงูุฑูููุฉ</p>
                </div>
            </div>
            
            <!-- Additional Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card">
                    <i class="fas fa-layer-group stat-icon text-indigo-600"></i>
                    <div class="stat-number text-indigo-600" id="total-generations">1</div>
                    <p class="text-gray-600 font-medium">ุงูุฃุฌูุงู</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-crown stat-icon text-amber-600"></i>
                    <div class="stat-number text-amber-600" id="board-members">0</div>
                    <p class="text-gray-600 font-medium">ุฃุนุถุงุก ุงูุฅุฏุงุฑุฉ</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-chart-line stat-icon text-rose-600"></i>
                    <div class="stat-number text-rose-600" id="active-events">0</div>
                    <p class="text-gray-600 font-medium">ุฃุญุฏุงุซ ูุดุทุฉ</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-thumbs-up stat-icon text-emerald-600"></i>
                    <div class="stat-number text-emerald-600" id="approved-suggestions">0</div>
                    <p class="text-gray-600 font-medium">ุงูุชุฑุงุญุงุช ููุจููุฉ</p>
                </div>
            </div>
            
            <!-- Welcome Message -->
            <div class="card p-8 text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">ูุฑุญุจุงู ุจูู ูู ุชุทุจูู ุขู ุณุนูุฏุงู ุงูุดุงูู</h2>
                <p class="text-xl text-gray-600 mb-6">ุฅุฏุงุฑุฉ ูุชูุงููุฉ ููุดุฌุฑุฉ ุงูุนุงุฆููุฉ ูุน ุฑุจุท ุงูุฃุฌูุงูุ ุงูุฃุญุฏุงุซุ ุงูุงูุชุฑุงุญุงุช ูุงูููุชุจุฉ ุงูุฑูููุฉ</p>
                
                <div class="bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-blue-800 mb-3">
                        <i class="fas fa-sitemap ml-2"></i>
                        ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ: ุงูุฃุฌูุงู ุงููุชุฑุงุจุทุฉ
                    </h3>
                    <p class="text-blue-700 font-medium mb-2">๐ณ ูู ุนุถู ุฌุฏูุฏ ููุฑุจุท ุชููุงุฆูุงู ุจุงูุฌูู ุงูุณุงุจู</p>
                    <p class="text-blue-700 font-medium mb-2">๐ข ุญุณุงุจ ุชููุงุฆู ููุฃุฌูุงู: ุงูุฌูู = ุฌูู ุงููุงูุฏ + 1</p>
                    <p class="text-blue-700 font-medium">๐จโ๐ฉโ๐งโ๐ฆ ุนุฑุถ ูุฑูู ููุธู ููุนุงุฆูุฉ ุญุณุจ ุงูุฃุฌูุงู</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="showSection('family')" class="btn-primary text-white px-8 py-4 rounded-lg text-lg">
                        <i class="fas fa-sitemap ml-2"></i>ุงุณุชูุดู ุงูุดุฌุฑุฉ ุงูุนุงุฆููุฉ
                    </button>
                    <button onclick="loadSampleData()" class="bg-amber-600 text-white px-8 py-4 rounded-lg text-lg hover:bg-amber-700">
                        <i class="fas fa-database ml-2"></i>ุชุญููู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
                    </button>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ุชูุฒูุน ุงูุนุถููุฉ</h3>
                    <canvas id="membershipChart" width="400" height="300"></canvas>
                </div>
                <div class="card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ุงููุดุงุท ุงูุดูุฑู</h3>
                    <canvas id="activityChart" width="400" height="300"></canvas>
                </div>
            </div>
        </section>

        <!-- Family Section -->
        <section id="family-section" class="section">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white">ุงูุดุฌุฑุฉ ุงูุนุงุฆููุฉ ุจุงูุฃุฌูุงู ุงููุชุฑุงุจุทุฉ</h2>
                <div class="flex gap-3">
                    <button onclick="testSecondGenerationRetrieval()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" title="ุงุฎุชุจุงุฑ ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุฌูู ุงูุซุงูู">
                        <i class="fas fa-search ml-2"></i>ุงุฎุชุจุงุฑ ุงูุฌูู ุงูุซุงูู
                    </button>
                    <button onclick="loadFounderFamily()" class="bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700">
                        <i class="fas fa-crown ml-2"></i>ุชุญููู ุงูุนุงุฆูุฉ ุงูุฃุณุงุณูุฉ
                    </button>
                    <button onclick="showFamilyModal()" class="btn-primary text-white px-6 py-3 rounded-lg">
                        <i class="fas fa-plus ml-2"></i>ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ
                    </button>
                </div>
            </div>
            
            <!-- ุญุงูุฉ ุงูุจูุงูุงุช -->
            <div id="data-status" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-center">
                <div class="flex items-center justify-center space-x-4 rtl:space-x-reverse">
                    <div class="text-blue-700">
                        <span id="member-count-display">๐ ูุง ุชูุฌุฏ ุจูุงูุงุช</span>
                    </div>
                    <div class="text-green-700">
                        <span id="generation-count-display">๐ณ ุงูุฃุฌูุงู: 0</span>
                    </div>
                </div>
            </div>

            <div id="family-tree" class="space-y-6">
                <!-- Family tree will be displayed here -->
            </div>
        </section>

        <!-- Events Section -->
        <section id="events-section" class="section">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white">ุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ</h2>
                <button onclick="showEventModal()" class="btn-primary text-white px-6 py-3 rounded-lg">
                    <i class="fas fa-plus ml-2"></i>ุฅุถุงูุฉ ุญุฏุซ ุฌุฏูุฏ
                </button>
            </div>
            
            <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Events will be displayed here -->
            </div>
        </section>

        <!-- Suggestions Section -->
        <section id="suggestions-section" class="section">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white">ุงูุงูุชุฑุงุญุงุช ูุงูุชุทููุฑ</h2>
                <button onclick="showSuggestionModal()" class="btn-primary text-white px-6 py-3 rounded-lg">
                    <i class="fas fa-plus ml-2"></i>ุฅุถุงูุฉ ุงูุชุฑุงุญ ุฌุฏูุฏ
                </button>
            </div>
            
            <div id="suggestions-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Suggestions will be displayed here -->
            </div>
        </section>

        <!-- Library Section -->
        <section id="library-section" class="section">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white">ุงูููุชุจุฉ ุงูุฑูููุฉ</h2>
                <button onclick="showLibraryModal()" class="btn-primary text-white px-6 py-3 rounded-lg">
                    <i class="fas fa-plus ml-2"></i>ุฅุถุงูุฉ ูุญุชูู ุฌุฏูุฏ
                </button>
            </div>
            
            <div id="library-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Library items will be displayed here -->
            </div>
        </section>
    </div>

    <!-- Family Member Modal -->
    <div id="familyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-6 rounded-lg max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="familyModalTitle">ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ ููุนุงุฆูุฉ</h3>
                <button type="button" onclick="hideFamilyModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="familyForm">
                <!-- ูุนูููุงุช ุงูุงุณู -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                        <i class="fas fa-user ml-2"></i>ุจูุงูุงุช ุงูุงุณู
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุงุณู ุงูุฃูู *</label>
                            <input type="text" id="familyFirstName" placeholder="ูุซุงู: ุฃุญูุฏ" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุงุณู ุงูุฃูุณุท</label>
                            <input type="text" id="familyMiddleName" placeholder="ูุซุงู: ูุญูุฏ" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงูุนุงุฆูุฉ *</label>
                            <input type="text" id="familyLastName" placeholder="ูุซุงู: ุจู ุณุนูุฏุงู" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-white rounded border">
                        <label class="block text-xs font-medium text-gray-500 mb-1">ุงูุงุณู ุงููุงูู (ูุนุงููุฉ)</label>
                        <div id="fullNamePreview" class="text-lg font-semibold text-gray-800">ุณูุชู ุชูููู ุงูุงุณู ุชููุงุฆูุงู...</div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงููููุงุฏ -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-green-800 mb-4 flex items-center">
                        <i class="fas fa-birthday-cake ml-2"></i>ุจูุงูุงุช ุงููููุงุฏ
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุชุงุฑูุฎ ุงููููุงุฏ</label>
                            <input type="date" id="familyBirthDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ููุงู ุงููููุงุฏ</label>
                            <input type="text" id="familyBirthPlace" placeholder="ูุซุงู: ุงูุฑูุงุถุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงูุฃุฌูุงู -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-amber-800 mb-4 flex items-center">
                        <i class="fas fa-sitemap ml-2"></i>ุฑุจุท ุงูุฃุฌูุงู
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงููุงูุฏ/ุงูุฌูู ุงูุณุงุจู</label>
                            <select id="familyFatherId" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">-- ุงุฎุชุฑ ุงููุงูุฏ --</option>
                            </select>
                            <p class="text-sm text-gray-500 mt-1">ุงุฎุชุฑ ูู ุงูุฌูู ุงูุณุงุจู ูุฅูุดุงุก ุงูุฑุงุจุท ุงูุนุงุฆูู</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุฌูู ุงูุญุงูู</label>
                            <input type="text" id="familyCurrentGeneration" placeholder="ุณูุชู ุญุณุงุจู ุชููุงุฆูุงู" class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg" readonly>
                            <p class="text-sm text-green-600 mt-1">ููุญุณุจ ุชููุงุฆูุงู ุจูุงุกู ุนูู ุงููุงูุฏ ุงููุฎุชุงุฑ</p>
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุดุฎุตูุฉ -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-purple-800 mb-4 flex items-center">
                        <i class="fas fa-id-card ml-2"></i>ุงููุนูููุงุช ุงูุดุฎุตูุฉ
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุฌูุณ *</label>
                            <select id="familyGender" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                <option value="">-- ุงุฎุชุฑ ุงูุฌูุณ --</option>
                                <option value="male">ุฐูุฑ</option>
                                <option value="female">ุฃูุซู</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ุงูุนุถููุฉ *</label>
                            <select id="familyMembershipType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                <option value="">-- ุงุฎุชุฑ ููุน ุงูุนุถููุฉ --</option>
                                <option value="founder">๐ ูุคุณุณ</option>
                                <option value="chairman">๐๏ธ ุฑุฆูุณ ูุฌูุณ ุงูุฅุฏุงุฑุฉ</option>
                                <option value="board_member">๐ ุนุถู ูุฌูุณ ุงูุฅุฏุงุฑุฉ</option>
                                <option value="general_assembly">๐ฅ ุนุถู ุงูุฌูุนูุฉ ุงูุนููููุฉ</option>
                                <option value="family_member">๐จโ๐ฉโ๐งโ๐ฆ ุนุถู ุนุงุฆูุฉ</option>
                                <option value="honorary">๐ ุนุถู ุดุฑูู</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ููููุฉ -->
                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-indigo-800 mb-4 flex items-center">
                        <i class="fas fa-briefcase ml-2"></i>ุงููุนูููุงุช ุงูููููุฉ
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงููููุฉ</label>
                            <input type="text" id="familyProfession" placeholder="ูุซุงู: ูููุฏุณุ ุทุจูุจุ ูุนูู" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุฎุตุต ุงูุนููู</label>
                            <input type="text" id="familySpecialization" placeholder="ูุซุงู: ููุฏุณุฉ ุงูุญุงุณูุจุ ุทุจ ุงูุฃุทูุงู" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงูุงุชุตุงู -->
                <div class="bg-teal-50 border border-teal-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-teal-800 mb-4 flex items-center">
                        <i class="fas fa-phone ml-2"></i>ูุนูููุงุช ุงูุชูุงุตู
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูู ุงูุฌูุงู</label>
                            <input type="tel" id="familyPhone" placeholder="05xxxxxxxx" pattern="[0-9]{10}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-500 mt-1">ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุฌูุงู ุจุตูุบุฉ 05xxxxxxxx</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                            <input type="email" id="familyEmail" placeholder="example@email.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
                <div class="bg-rose-50 border border-rose-200 rounded-lg p-4 mb-6">
                    <h4 class="text-lg font-semibold text-rose-800 mb-4 flex items-center">
                        <i class="fas fa-heart ml-2"></i>ุงููุนูููุงุช ุงูุฅุถุงููุฉ
                    </h4>
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุงูููุงูุงุช ูุงูุงูุชูุงูุงุช</label>
                            <textarea id="familyHobbies" rows="3" placeholder="ูุซุงู: ุงููุฑุงุกุฉุ ุงูุฑูุงุถุฉุ ุงูุณูุฑุ ุงูุชุตููุฑุ ุงูุจุฑูุฌุฉ..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical"></textarea>
                        </div>
                    </div>
                </div>

                <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู -->
                <div class="flex justify-end space-x-4 rtl:space-x-reverse pt-4 border-t border-gray-200">
                    <button type="button" onclick="hideFamilyModal()" class="px-8 py-3 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition font-medium">
                        <i class="fas fa-times ml-2"></i>ุฅูุบุงุก
                    </button>
                    <button type="button" onclick="resetFamilyForm()" class="px-8 py-3 text-amber-600 bg-amber-100 border border-amber-300 rounded-lg hover:bg-amber-200 transition font-medium">
                        <i class="fas fa-refresh ml-2"></i>ุฅุนุงุฏุฉ ุชุนููู
                    </button>
                    <button type="submit" class="px-8 py-3 bg-gradient-to-r from-blue-600 to-green-600 text-white rounded-lg hover:from-blue-700 hover:to-green-700 transition font-medium shadow-lg">
                        <i class="fas fa-save ml-2"></i>ุญูุธ ุงูุนุถู
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ุจูุงูุงุช ุงูุนุงุฆูุฉ ุงูุฃุณุงุณูุฉ ูุน ุงูุฌูู ุงูุซุงูู
        const SAMPLE_FAMILY_DATA = {
            familyMembers: [
                // ุงูุฌูู ุงููุคุณุณ
                {
                    id: 'founder_001',
                    full_name: 'ูุญูุฏ ุจู ุณุนูุฏุงู',
                    first_name: 'ูุญูุฏ',
                    middle_name: '',
                    last_name: 'ุจู ุณุนูุฏุงู',
                    membership_type: 'founder',
                    gender: 'male',
                    father_id: null,
                    generation: 1,
                    birth_date: '1950-01-01',
                    birth_place: 'ุงูุฑูุงุถุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ',
                    profession: 'ุฑุฌู ุฃุนูุงู',
                    specialization: 'ุงูุชุทููุฑ ุงูุนูุงุฑู',
                    phone: '0533361154',
                    email: 'info@salmansaedan.com',
                    hobbies: 'ุงููุฑุงุกุฉุ ุงูุงุณุชุซูุงุฑ ุงูุนูุงุฑูุ ุงูุฃุนูุงู ุงูุฎูุฑูุฉ',
                    created_at: '2024-01-01'
                },
                // ุงูุฌูู ุงูุซุงูู - ุฃุทูุงู ุงููุคุณุณ
                {
                    id: 'gen2_001',
                    full_name: 'ุณููุงู ูุญูุฏ ุจู ุณุนูุฏุงู',
                    first_name: 'ุณููุงู',
                    middle_name: 'ูุญูุฏ',
                    last_name: 'ุจู ุณุนูุฏุงู',
                    membership_type: 'chairman',
                    gender: 'male',
                    father_id: 'founder_001',
                    generation: 2,
                    birth_date: '1975-05-15',
                    birth_place: 'ุงูุฑูุงุถุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ',
                    profession: 'ูุทูุฑ ุนูุงุฑู',
                    specialization: 'ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ุงูุนูุงุฑูุฉ',
                    phone: '0501234567',
                    email: 'salman@salmansaedan.com',
                    hobbies: 'ุงูุณูุฑุ ุงูุชุตููุฑุ ุงูุฑูุงุถุฉุ ุชุทููุฑ ุงูุฃุนูุงู',
                    created_at: '2024-01-02'
                },
                {
                    id: 'gen2_002',
                    full_name: 'ุนุจุฏุงููู ูุญูุฏ ุจู ุณุนูุฏุงู',
                    first_name: 'ุนุจุฏุงููู',
                    middle_name: 'ูุญูุฏ',
                    last_name: 'ุจู ุณุนูุฏุงู',
                    membership_type: 'board_member',
                    gender: 'male',
                    father_id: 'founder_001',
                    generation: 2,
                    birth_date: '1977-08-20',
                    birth_place: 'ุฌุฏุฉุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ',
                    profession: 'ูููุฏุณ',
                    specialization: 'ููุฏุณุฉ ูุนูุงุฑูุฉ',
                    phone: '0507654321',
                    email: 'abdullah@example.com',
                    hobbies: 'ุงูุชุตููู ุงููุนูุงุฑูุ ุงูุฑุณูุ ุงูุณุจุงุญุฉ',
                    created_at: '2024-01-03'
                },
                {
                    id: 'gen2_003',
                    full_name: 'ูุงุทูุฉ ูุญูุฏ ุจู ุณุนูุฏุงู',
                    first_name: 'ูุงุทูุฉ',
                    middle_name: 'ูุญูุฏ',
                    last_name: 'ุจู ุณุนูุฏุงู',
                    membership_type: 'family_member',
                    gender: 'female',
                    father_id: 'founder_001',
                    generation: 2,
                    birth_date: '1980-03-10',
                    birth_place: 'ุงูุฏูุงูุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ',
                    profession: 'ุทุจูุจุฉ',
                    specialization: 'ุทุจ ุงูุฃุทูุงู',
                    phone: '0551234567',
                    email: 'fatima@example.com',
                    hobbies: 'ุงููุฑุงุกุฉ ุงูุทุจูุฉุ ุฑุนุงูุฉ ุงูุฃุทูุงูุ ุงูุทุจุฎ',
                    created_at: '2024-01-04'
                },
                {
                    id: 'gen2_004',
                    full_name: 'ุฃุญูุฏ ูุญูุฏ ุจู ุณุนูุฏุงู',
                    first_name: 'ุฃุญูุฏ',
                    middle_name: 'ูุญูุฏ',
                    last_name: 'ุจู ุณุนูุฏุงู',
                    membership_type: 'general_assembly',
                    gender: 'male',
                    father_id: 'founder_001',
                    generation: 2,
                    birth_date: '1982-11-30',
                    birth_place: 'ุงูุฑูุงุถุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ',
                    profession: 'ูุนูู',
                    specialization: 'ุงูุชุฑุจูุฉ ูุงูุชุนููู',
                    phone: '0559876543',
                    email: 'ahmed@example.com',
                    hobbies: 'ุงูุชุฏุฑูุณุ ุงููุฑุงุกุฉุ ูุฑุฉ ุงููุฏูุ ุงูุดุทุฑูุฌ',
                    created_at: '2024-01-05'
                },
                {
                    id: 'gen2_005',
                    full_name: 'ุนุงุฆุดุฉ ูุญูุฏ ุจู ุณุนูุฏุงู',
                    first_name: 'ุนุงุฆุดุฉ',
                    middle_name: 'ูุญูุฏ',
                    last_name: 'ุจู ุณุนูุฏุงู',
                    membership_type: 'family_member',
                    gender: 'female',
                    father_id: 'founder_001',
                    generation: 2,
                    birth_date: '1985-07-18',
                    birth_place: 'ููุฉ ุงูููุฑูุฉุ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ',
                    profession: 'ูุตููุฉ',
                    specialization: 'ุชุตููู ุงูุฏูููุฑ ุงูุฏุงุฎูู',
                    phone: '0554567890',
                    email: 'aisha@example.com',
                    hobbies: 'ุงูุชุตูููุ ุงูุฑุณูุ ุงูุฎูุงุทุฉุ ุงููููู ุงููุฏููุฉ',
                    created_at: '2024-01-06'
                }
            ],
            events: [
                {
                    id: 'event_001',
                    title: 'ุงุฌุชูุงุน ุงูุนุงุฆูุฉ ุงูุณููู',
                    description: 'ุงูุงุฌุชูุงุน ุงูุณููู ูุฌููุน ุฃูุฑุงุฏ ุงูุนุงุฆูุฉ',
                    date: '2024-12-15',
                    time: '18:00',
                    location: 'ูุงุนุฉ ุงูููู ููุฏ',
                    type: 'family',
                    status: 'upcoming',
                    attendees: 45
                }
            ],
            suggestions: [
                {
                    id: 'sugg_001',
                    title: 'ุชุทููุฑ ูููุน ุงูุนุงุฆูุฉ ุงูุฅููุชุฑููู',
                    description: 'ุฅูุดุงุก ูููุน ุฅููุชุฑููู ูุชูุฏู ูุฃูุฑุงุฏ ุงูุนุงุฆูุฉ',
                    category: 'ุชุทููุฑ',
                    status: 'approved',
                    submitted_by: 'ุณููุงู ุจู ุณุนูุฏุงู',
                    upvotes: 15,
                    downvotes: 2,
                    comments: 8
                }
            ],
            library: [
                {
                    id: 'lib_001',
                    title: 'ุชุงุฑูุฎ ุนุงุฆูุฉ ุจู ุณุนูุฏุงู',
                    author: 'ุงูุจุงุญุซ ุงูุชุงุฑูุฎู',
                    type: 'document',
                    category: 'ุชุงุฑูุฎ',
                    file_url: '#',
                    tags: ['ุชุงุฑูุฎ', 'ูุณุจ', 'ุนุงุฆูุฉ']
                }
            ]
        };

        // ูุธุงู ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช ุงููุญุณู
        class EnhancedDataManager {
            constructor() {
                this.storageKey = 'al_saedan_app_v2';
                this.data = this.loadData();
                this.initializeDefaultData();
                this.setupStorageSync();
            }

            loadData() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        return {
                            familyMembers: parsed.familyMembers || [],
                            events: parsed.events || [],
                            suggestions: parsed.suggestions || [],
                            library: parsed.library || [],
                            lastUpdated: parsed.lastUpdated || new Date().toISOString(),
                            version: parsed.version || 1
                        };
                    }
                    return {
                        familyMembers: [],
                        events: [],
                        suggestions: [],
                        library: [],
                        lastUpdated: new Date().toISOString(),
                        version: 1
                    };
                } catch (error) {
                    console.error('ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช:', error);
                    return {
                        familyMembers: [],
                        events: [],
                        suggestions: [],
                        library: [],
                        lastUpdated: new Date().toISOString(),
                        version: 1
                    };
                }
            }

            saveData() {
                try {
                    this.data.lastUpdated = new Date().toISOString();
                    this.data.version = (this.data.version || 0) + 1;
                    localStorage.setItem(this.storageKey, JSON.stringify(this.data));
                    
                    // ุฅุดุนุงู ุญุฏุซ ุชุญุฏูุซ ุงูุจูุงูุงุช
                    window.dispatchEvent(new CustomEvent('dataUpdated', { detail: this.data }));
                    
                    return true;
                } catch (error) {
                    console.error('ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช:', error);
                    return false;
                }
            }

            initializeDefaultData() {
                // ุชุญููู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุฅุฐุง ูุงูุช ูุงุฑุบุฉ
                if (this.data.familyMembers.length === 0) {
                    console.log('๐ ูุง ุชูุฌุฏ ุจูุงูุงุช ุนุงุฆููุฉ - ุฌุงูุฒ ูุชุญููู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ');
                } else {
                    console.log(`โ ุชู ุงูุนุซูุฑ ุนูู ${this.data.familyMembers.length} ุนุถู ูู ุงูุนุงุฆูุฉ`);
                    // ุงูุชุญูู ูู ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุฌูู ุงูุซุงูู
                    const secondGenMembers = this.data.familyMembers.filter(m => m.generation === 2);
                    console.log(`๐ณ ุงูุฌูู ุงูุซุงูู: ${secondGenMembers.length} ุฃุนุถุงุก`);
                    secondGenMembers.forEach(member => {
                        console.log(`   - ${member.full_name} (ุงููุงูุฏ: ${member.father_id || 'ุบูุฑ ูุญุฏุฏ'})`);
                    });
                    
                    // ุชุญุฏูุซ ูุฑุงุฌุน ุงูุฃุทูุงู ููุฃุนุถุงุก ุงูููุฌูุฏูู
                    this.updateChildrenReferences();
                }
            }

            // ุชุญุฏูุซ ูุฑุงุฌุน ุงูุฃุทูุงู ููู ุนุถู
            updateChildrenReferences() {
                this.data.familyMembers.forEach(member => {
                    member.children = this.data.familyMembers
                        .filter(child => child.father_id === member.id)
                        .map(child => child.id);
                });
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            getData(category) {
                return this.data[category] || [];
            }

            addItem(category, item) {
                if (!this.data[category]) {
                    this.data[category] = [];
                }
                
                // ุญุณุงุจ ุงูุฌูู ููุฃุนุถุงุก ุงูุฌุฏุฏ
                if (category === 'familyMembers') {
                    item.generation = this.calculateGeneration(item.father_id);
                    item.id = item.id || this.generateId();
                    item.created_at = item.created_at || new Date().toISOString();
                }
                
                const newItem = {
                    ...item,
                    id: item.id || this.generateId(),
                    created_at: item.created_at || new Date().toISOString()
                };
                
                this.data[category].push(newItem);
                
                // ุชุญุฏูุซ ูุฑุงุฌุน ุงูุฃุทูุงู ููุนุงุฆูุฉ
                if (category === 'familyMembers') {
                    this.updateChildrenReferences();
                }
                
                this.saveData();
                return newItem;
            }

            // ุญุณุงุจ ุงูุฌูู ุจูุงุกู ุนูู ุงููุงูุฏ
            calculateGeneration(fatherId) {
                if (!fatherId) return 1; // ุงููุคุณุณ
                
                const father = this.data.familyMembers.find(m => m.id === fatherId);
                return father ? (father.generation + 1) : 1;
            }

            updateItem(category, id, updates) {
                const items = this.data[category];
                const index = items.findIndex(item => item.id === id);
                
                if (index !== -1) {
                    // ุฅุฐุง ุชู ุชุญุฏูุซ ุงููุงูุฏุ ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฌูู
                    if (category === 'familyMembers' && updates.father_id !== undefined) {
                        updates.generation = this.calculateGeneration(updates.father_id);
                    }
                    
                    items[index] = { 
                        ...items[index], 
                        ...updates,
                        updated_at: new Date().toISOString()
                    };
                    
                    // ุชุญุฏูุซ ูุฑุงุฌุน ุงูุฃุทูุงู ููุนุงุฆูุฉ
                    if (category === 'familyMembers') {
                        this.updateChildrenReferences();
                    }
                    
                    this.saveData();
                    return items[index];
                }
                return null;
            }

            deleteItem(category, id) {
                const items = this.data[category];
                const index = items.findIndex(item => item.id === id);
                
                if (index !== -1) {
                    // ููุนุงุฆูุฉ: ุงูุชุญูู ูู ูุฌูุฏ ุฃุทูุงู
                    if (category === 'familyMembers') {
                        const hasChildren = this.data.familyMembers.some(m => m.father_id === id);
                        if (hasChildren) {
                            throw new Error('ูุง ูููู ุญุฐู ุนุถู ูุฏูู ุฃุทูุงู. ุงุญุฐู ุงูุฃุทูุงู ุฃููุงู.');
                        }
                    }
                    
                    const deletedItem = items.splice(index, 1)[0];
                    
                    // ุชุญุฏูุซ ูุฑุงุฌุน ุงูุฃุทูุงู ููุนุงุฆูุฉ
                    if (category === 'familyMembers') {
                        this.updateChildrenReferences();
                    }
                    
                    this.saveData();
                    return deletedItem;
                }
                return null;
            }

            // ุชุญููู ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ
            loadSampleData() {
                this.data = { ...this.data, ...SAMPLE_FAMILY_DATA };
                this.updateChildrenReferences();
                this.saveData();
                
                // ุชุฃููุฏ ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุฌูู ุงูุซุงูู
                const secondGenMembers = this.data.familyMembers.filter(m => m.generation === 2);
                console.log('๐ ุชุญููู ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ ููุชูู:');
                console.log(`   - ุฅุฌูุงูู ุงูุฃุนุถุงุก: ${this.data.familyMembers.length}`);
                console.log(`   - ุงูุฌูู ุงูุซุงูู: ${secondGenMembers.length} ุฃุนุถุงุก`);
                console.log('โ ุชู ุชุญููู ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ ุจูุฌุงุญ ูุน ุฑุจุท ุงูุฃุฌูุงู');
                
                // ุฅุดุนุงู ุญุฏุซ ุชุญุฏูุซ ุงูุจูุงูุงุช
                window.dispatchEvent(new CustomEvent('sampleDataLoaded', { 
                    detail: { 
                        totalMembers: this.data.familyMembers.length,
                        secondGeneration: secondGenMembers.length
                    } 
                }));
            }

            // ูุฒุงููุฉ ูุน ุงูููุงูุฐ ุงูุฃุฎุฑู
            setupStorageSync() {
                window.addEventListener('storage', (e) => {
                    if (e.key === this.storageKey) {
                        this.data = this.loadData();
                        window.dispatchEvent(new CustomEvent('dataUpdated', { detail: this.data }));
                    }
                });
            }

            // ุงูุจุญุซ ูุงูููุชุฑุฉ
            searchItems(category, query, filters = {}) {
                let items = this.getData(category);

                // ุงูุจุญุซ ุงููุตู
                if (query) {
                    const searchTerms = query.toLowerCase().split(' ');
                    items = items.filter(item => 
                        searchTerms.every(term =>
                            Object.values(item).some(value =>
                                value && value.toString().toLowerCase().includes(term)
                            )
                        )
                    );
                }

                // ุชุทุจูู ุงูููุงุชุฑ
                Object.keys(filters).forEach(key => {
                    if (filters[key]) {
                        items = items.filter(item => item[key] === filters[key]);
                    }
                });

                return items;
            }
        }

        // ุงูุชุทุจูู ุงูุฑุฆูุณู ุงููุญุณู
        class EnhancedAlSaedanApp {
            constructor() {
                this.dataManager = new EnhancedDataManager();
                this.charts = {};
                this.init();
            }

            init() {
                this.createModals();
                this.displayHomeStatistics();
                this.displayFamilyTree();
                this.displayEvents();
                this.displaySuggestions();
                this.displayLibrary();
                this.initializeCharts();
                this.setupEventListeners();
                console.log('ุชู ุชุญููู ุงูุชุทุจูู ุงูุดุงูู ุงููุญุณู ุจูุฌุงุญ');
            }

            setupEventListeners() {
                // ูุณุชูุน ุชุญุฏูุซ ุงูุจูุงูุงุช
                window.addEventListener('dataUpdated', () => {
                    this.refreshAllSections();
                });

                // ูุณุชูุน ุชุญููู ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ
                window.addEventListener('sampleDataLoaded', (event) => {
                    const { totalMembers, secondGeneration } = event.detail;
                    console.log(`๐ ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ ูุญููุฉ: ${totalMembers} ุฃุนุถุงุกุ ${secondGeneration} ูู ุงูุฌูู ุงูุซุงูู`);
                    
                    // ุงูุชุญูู ูู ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุฌูู ุงูุซุงูู
                    const members = this.dataManager.getData('familyMembers');
                    const secondGenData = members.filter(m => m.generation === 2);
                    console.log('๐ ุชูุงุตูู ุงูุฌูู ุงูุซุงูู ุงููุณุชุฑุฌุน:');
                    secondGenData.forEach(member => {
                        console.log(`   โ ${member.full_name} - ุฌูู ${member.generation} - ูุงูุฏ: ${member.father_id}`);
                    });
                });

                // ูุณุชูุน ูููุฐุฌ ุงูุนุงุฆูุฉ
                const familyForm = document.getElementById('familyForm');
                if (familyForm) {
                    familyForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveFamilyMember();
                    });
                }

                // ูุณุชูุนุงุช ุญููู ุงููููุฐุฌ ุงููุญุณู
                this.setupFormFieldListeners();
            }

            setupFormFieldListeners() {
                // ุชุญุฏูุซ ูุนุงููุฉ ุงูุงุณู ุงููุงูู
                const nameFields = ['familyFirstName', 'familyMiddleName', 'familyLastName'];
                nameFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', this.updateFullNamePreview.bind(this));
                    }
                });

                // ุชุญุฏูุซ ุงูุฌูู ุนูุฏ ุงุฎุชูุงุฑ ุงููุงูุฏ
                const fatherSelect = document.getElementById('familyFatherId');
                if (fatherSelect) {
                    fatherSelect.addEventListener('change', this.updateGenerationDisplay.bind(this));
                }
            }

            updateFullNamePreview() {
                const firstName = document.getElementById('familyFirstName')?.value.trim() || '';
                const middleName = document.getElementById('familyMiddleName')?.value.trim() || '';
                const lastName = document.getElementById('familyLastName')?.value.trim() || '';
                
                let fullName = firstName;
                if (middleName) fullName += ` ${middleName}`;
                if (lastName) fullName += ` ${lastName}`;
                
                const preview = document.getElementById('fullNamePreview');
                if (preview) {
                    preview.textContent = fullName || 'ุณูุชู ุชูููู ุงูุงุณู ุชููุงุฆูุงู...';
                }
            }

            updateGenerationDisplay() {
                const fatherSelect = document.getElementById('familyFatherId');
                const generationDisplay = document.getElementById('familyCurrentGeneration');
                
                if (!fatherSelect || !generationDisplay) return;

                const fatherId = fatherSelect.value;
                let generation = 1; // ุงูุชุฑุงุถู ูููุคุณุณ

                if (fatherId) {
                    const father = this.dataManager.getData('familyMembers').find(m => m.id === fatherId);
                    generation = father ? (father.generation + 1) : 1;
                }

                generationDisplay.value = `ุงูุฌูู ${generation} ${generation === 1 ? '(ูุคุณุณ)' : generation === 2 ? '(ุฃุทูุงู ุงููุคุณุณ)' : '(ุฃุญูุงุฏ)'}`;
            }

            refreshAllSections() {
                this.displayHomeStatistics();
                this.displayFamilyTree();
                this.displayEvents();
                this.displaySuggestions();
                this.displayLibrary();
                this.updateCharts();
            }

            // ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
            displayHomeStatistics() {
                const stats = {
                    members: this.dataManager.getData('familyMembers').length,
                    events: this.dataManager.getData('events').length,
                    suggestions: this.dataManager.getData('suggestions').length,
                    library: this.dataManager.getData('library').length
                };

                // ุฅุญุตุงุฆูุงุช ุฅุถุงููุฉ
                const familyMembers = this.dataManager.getData('familyMembers');
                const generations = new Set(familyMembers.map(m => m.generation || 1)).size;
                const boardMembers = familyMembers.filter(m => 
                    ['founder', 'chairman', 'board_member'].includes(m.membership_type)
                ).length;
                
                const events = this.dataManager.getData('events');
                const activeEvents = events.filter(e => e.status === 'upcoming').length;
                
                const suggestions = this.dataManager.getData('suggestions');
                const approvedSuggestions = suggestions.filter(s => s.status === 'approved').length;

                // ุชุญุฏูุซ ุงูุนุฏุงุฏุงุช
                this.updateCounter('total-members', stats.members);
                this.updateCounter('total-events', stats.events);
                this.updateCounter('total-suggestions', stats.suggestions);
                this.updateCounter('total-library', stats.library);
                this.updateCounter('total-generations', generations);
                this.updateCounter('board-members', boardMembers);
                this.updateCounter('active-events', activeEvents);
                this.updateCounter('approved-suggestions', approvedSuggestions);
            }

            updateCounter(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    // ุชุฃุซูุฑ ุงูุนุฏ ุงูุชุตุงุนุฏู
                    const current = parseInt(element.textContent) || 0;
                    const increment = Math.ceil((value - current) / 10);
                    let counter = current;
                    
                    const timer = setInterval(() => {
                        counter += increment;
                        if (counter >= value) {
                            counter = value;
                            clearInterval(timer);
                        }
                        element.textContent = counter;
                    }, 50);
                }
            }

            // ุนุฑุถ ุงูุดุฌุฑุฉ ุงูุนุงุฆููุฉ ุงููุญุณูุฉ
            displayFamilyTree() {
                const familyMembers = this.dataManager.getData('familyMembers');
                const container = document.getElementById('family-tree');
                if (!container) return;

                // ุชุญุฏูุซ ุญุงูุฉ ุงูุจูุงูุงุช
                this.updateDataStatus(familyMembers);

                if (familyMembers.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <div class="text-6xl text-white mb-4 opacity-50">
                                <i class="fas fa-sitemap"></i>
                            </div>
                            <p class="text-white text-xl mb-6">ูุง ุชูุฌุฏ ุดุฌุฑุฉ ุนุงุฆููุฉ</p>
                            <button onclick="loadSampleData()" class="bg-amber-600 text-white px-8 py-4 rounded-lg hover:bg-amber-700 text-lg">
                                <i class="fas fa-database ml-2"></i>ุชุญููู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
                            </button>
                        </div>
                    `;
                    return;
                }

                // ุชุฌููุน ุญุณุจ ุงูุฃุฌูุงู
                const generations = {};
                familyMembers.forEach(member => {
                    const gen = member.generation || 1;
                    if (!generations[gen]) generations[gen] = [];
                    generations[gen].push(member);
                });

                // ุนุฑุถ ุงูุฃุฌูุงู
                container.innerHTML = Object.keys(generations)
                    .sort((a, b) => parseInt(a) - parseInt(b))
                    .map(gen => {
                        const genMembers = generations[gen];
                        const isFounderGen = gen == '1';
                        
                        return `
                            <div class="generation">
                                <div class="generation-header">
                                    <i class="fas ${isFounderGen ? 'fa-crown' : 'fa-users'} ml-2"></i>
                                    ${isFounderGen ? 'ุงูุฌูู ุงููุคุณุณ' : `ุงูุฌูู ${this.getGenerationName(gen)}`}
                                    <span class="bg-white text-blue-600 px-3 py-1 rounded-full mr-3 font-bold">
                                        ${genMembers.length} ${genMembers.length === 1 ? 'ูุฑุฏ' : 'ุฃูุฑุงุฏ'}
                                    </span>
                                </div>
                                
                                ${genMembers.map(member => this.renderMemberCard(member, !isFounderGen)).join('')}
                            </div>
                        `;
                    }).join('');
            }

            renderMemberCard(member, showConnection = false) {
                const father = member.father_id ? 
                    this.dataManager.getData('familyMembers').find(m => m.id === member.father_id) : null;
                const childrenCount = member.children ? member.children.length : 0;
                
                return `
                    <div class="member-card ${member.membership_type === 'founder' ? 'founder-card' : ''} ${showConnection ? 'connection-line' : ''}">
                        <div class="card p-6 relative group">
                            <div class="member-actions">
                                <button onclick="editFamilyMember('${member.id}')" class="edit-btn" title="ุชุนุฏูู">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteFamilyMember('${member.id}')" class="delete-btn" title="ุญุฐู">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <div class="flex items-start">
                                <div class="w-16 h-16 bg-gradient-to-br ${member.membership_type === 'founder' ? 'from-amber-400 to-orange-500' : 'from-blue-400 to-blue-600'} rounded-full flex items-center justify-center text-white text-xl font-bold mr-4 shadow-lg">
                                    ${member.full_name.charAt(0)}
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-bold text-gray-800 mb-2">
                                        ${member.full_name}
                                        <span class="text-sm ${member.gender === 'male' ? 'text-blue-500' : 'text-pink-500'} mr-2">
                                            <i class="fas ${member.gender === 'male' ? 'fa-mars' : 'fa-venus'}"></i>
                                        </span>
                                    </h4>
                                    
                                    ${father ? `
                                        <p class="text-gray-600 text-sm mb-2">
                                            <i class="fas fa-arrow-up ml-2 text-blue-500"></i>
                                            ${member.gender === 'male' ? 'ุงุจู' : 'ุงุจูุฉ'} ${father.full_name}
                                        </p>
                                    ` : ''}
                                    
                                    <span class="inline-block px-3 py-1 text-xs rounded-full ${this.getMembershipTypeColor(member.membership_type)} mb-2">
                                        ${this.getMembershipTypeText(member.membership_type)}
                                    </span>
                                    
                                    ${childrenCount > 0 ? `
                                        <p class="text-green-600 text-sm mb-2">
                                            <i class="fas fa-arrow-down ml-2"></i>
                                            ${childrenCount} ${childrenCount === 1 ? 'ุทูู' : 'ุฃุทูุงู'}
                                        </p>
                                    ` : ''}
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-500 mt-3">
                                        ${member.birth_date ? `<div><i class="fas fa-birthday-cake ml-2 text-pink-500"></i>${new Date(member.birth_date).toLocaleDateString('ar-SA')}</div>` : ''}
                                        ${member.birth_place ? `<div><i class="fas fa-map-marker-alt ml-2 text-red-500"></i>${member.birth_place}</div>` : ''}
                                        ${member.profession ? `<div><i class="fas fa-briefcase ml-2 text-blue-500"></i>${member.profession}</div>` : ''}
                                        ${member.specialization ? `<div><i class="fas fa-graduation-cap ml-2 text-green-500"></i>${member.specialization}</div>` : ''}
                                        ${member.phone ? `<div><i class="fas fa-phone ml-2 text-indigo-500"></i>${member.phone}</div>` : ''}
                                        ${member.email ? `<div><i class="fas fa-envelope ml-2 text-purple-500"></i>${member.email}</div>` : ''}
                                    </div>
                                    ${member.hobbies ? `
                                        <div class="mt-3 p-2 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border border-amber-200">
                                            <div class="text-xs text-amber-700">
                                                <i class="fas fa-heart ml-2"></i>
                                                <strong>ุงูููุงูุงุช:</strong> ${member.hobbies}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getGenerationName(genNum) {
                const names = {
                    '2': 'ุงูุซุงูู (ุงูุฃุทูุงู)',
                    '3': 'ุงูุซุงูุซ (ุงูุฃุญูุงุฏ)', 
                    '4': 'ุงูุฑุงุจุน (ุฃุทูุงู ุงูุฃุญูุงุฏ)',
                    '5': 'ุงูุฎุงูุณ'
                };
                return names[genNum] || `ุฑูู ${genNum}`;
            }

            // ูุณุงุนุฏ ููุนุงุฆูุฉ
            getMembershipTypeColor(type) {
                const colors = {
                    'founder': 'bg-amber-100 text-amber-700 border border-amber-200',
                    'chairman': 'bg-red-100 text-red-700 border border-red-200',
                    'board_member': 'bg-blue-100 text-blue-700 border border-blue-200',
                    'general_assembly': 'bg-green-100 text-green-700 border border-green-200',
                    'family_member': 'bg-gray-100 text-gray-700 border border-gray-200',
                    'honorary': 'bg-purple-100 text-purple-700 border border-purple-200'
                };
                return colors[type] || 'bg-gray-100 text-gray-700';
            }

            getMembershipTypeText(type) {
                const texts = {
                    'founder': '๐ ุงููุคุณุณ',
                    'chairman': '๐๏ธ ุฑุฆูุณ ูุฌูุณ ุงูุฅุฏุงุฑุฉ',
                    'board_member': '๐ ุนุถู ูุฌูุณ ุงูุฅุฏุงุฑุฉ',
                    'general_assembly': '๐ฅ ุนุถู ุงูุฌูุนูุฉ ุงูุนููููุฉ',
                    'family_member': '๐จโ๐ฉโ๐งโ๐ฆ ุนุถู ุนุงุฆูุฉ',
                    'honorary': '๐ ุนุถู ุดุฑูู'
                };
                return texts[type] || type;
            }

            // ุชุญุฏูุซ ุญุงูุฉ ุงูุจูุงูุงุช
            updateDataStatus(familyMembers) {
                const memberCountDisplay = document.getElementById('member-count-display');
                const generationCountDisplay = document.getElementById('generation-count-display');
                
                if (memberCountDisplay && generationCountDisplay) {
                    const totalMembers = familyMembers.length;
                    const generations = new Set(familyMembers.map(m => m.generation || 1));
                    const secondGenCount = familyMembers.filter(m => m.generation === 2).length;
                    
                    memberCountDisplay.textContent = `๐ ุฅุฌูุงูู ุงูุฃุนุถุงุก: ${totalMembers}`;
                    generationCountDisplay.innerHTML = `๐ณ ุงูุฃุฌูุงู: ${generations.size} <span class="text-green-600 mr-2">| ุงูุฌูู ุงูุซุงูู: ${secondGenCount} ุฃุนุถุงุก</span>`;
                    
                    // ุชุณุฌูู ุชูุตููู ูู ุงููููุณูู
                    if (secondGenCount > 0) {
                        console.log(`โ ุชุฃููุฏ ุงุณุชุฑุฌุงุน ุงูุฌูู ุงูุซุงูู: ${secondGenCount} ุฃุนุถุงุก ูู ุฃุตู ${totalMembers}`);
                    }
                }
            }

            // ูููุฐุฌ ุงูุนุงุฆูุฉ
            showFamilyModal(memberId = null) {
                const modal = document.getElementById('familyModal');
                const title = document.getElementById('familyModalTitle');
                const form = document.getElementById('familyForm');
                
                if (memberId) {
                    // ุชุนุฏูู ุนุถู ููุฌูุฏ
                    const member = this.dataManager.getData('familyMembers').find(m => m.id === memberId);
                    if (member) {
                        title.textContent = 'ุชุนุฏูู ุจูุงูุงุช ุงูุนุถู';
                        this.fillFamilyForm(member);
                    }
                } else {
                    // ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ
                    title.textContent = 'ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ ููุนุงุฆูุฉ';
                    form.reset();
                }
                
                this.populateParentSelect();
                modal.classList.remove('hidden');
                
                // ุงูุชุฑููุฒ ุนูู ุฃูู ุญูู
                setTimeout(() => {
                    document.getElementById('familyFullName').focus();
                }, 100);
            }

            populateParentSelect() {
                const select = document.getElementById('familyFatherId');
                select.innerHTML = '<option value="">-- ุงุฎุชุฑ ุงููุงูุฏ --</option>';
                
                const maleMembers = this.dataManager.getData('familyMembers').filter(m => m.gender === 'male');
                
                // ุชุฌููุน ุญุณุจ ุงูุฃุฌูุงู
                const generations = {};
                maleMembers.forEach(member => {
                    const gen = member.generation || 1;
                    if (!generations[gen]) generations[gen] = [];
                    generations[gen].push(member);
                });
                
                // ุฅุถุงูุฉ ุงูุฎูุงุฑุงุช ูุฌููุนุฉ ุญุณุจ ุงูุฃุฌูุงู
                Object.keys(generations).sort((a, b) => parseInt(a) - parseInt(b)).forEach(genNum => {
                    const genGroup = document.createElement('optgroup');
                    genGroup.label = `${genNum == '1' ? 'ุงูุฌูู ุงููุคุณุณ' : 'ุงูุฌูู ' + genNum}`;
                    
                    generations[genNum].forEach(member => {
                        const option = document.createElement('option');
                        option.value = member.id;
                        option.textContent = `${member.full_name} (${this.getMembershipTypeText(member.membership_type).replace(/[๐๏ธ๐๐ฅ๐จโ๐ฉโ๐งโ๐ฆ๐๐]/g, '').trim()})`;
                        genGroup.appendChild(option);
                    });
                    
                    select.appendChild(genGroup);
                });
            }

            fillFamilyForm(member) {
                // ุชุญููู ุงูุงุณู ุงููุงูู
                const nameParts = (member.full_name || '').split(' ');
                document.getElementById('familyFirstName').value = nameParts[0] || '';
                document.getElementById('familyMiddleName').value = nameParts[1] || '';
                document.getElementById('familyLastName').value = nameParts.slice(2).join(' ') || '';
                
                // ุจุงูู ุงูุจูุงูุงุช
                document.getElementById('familyFatherId').value = member.father_id || '';
                document.getElementById('familyMembershipType').value = member.membership_type || '';
                document.getElementById('familyGender').value = member.gender || '';
                document.getElementById('familyBirthDate').value = member.birth_date || '';
                document.getElementById('familyBirthPlace').value = member.birth_place || '';
                document.getElementById('familyProfession').value = member.profession || '';
                document.getElementById('familySpecialization').value = member.specialization || '';
                document.getElementById('familyPhone').value = member.phone || '';
                document.getElementById('familyEmail').value = member.email || '';
                document.getElementById('familyHobbies').value = member.hobbies || '';
                
                // ุชุญุฏูุซ ุงููุนุงููุฉ ูุงูุฌูู
                this.updateFullNamePreview();
                this.updateGenerationDisplay();
                
                // ุญูุธ ID ููุชุนุฏูู
                document.getElementById('familyForm').dataset.editId = member.id;
            }

            saveFamilyMember() {
                const form = document.getElementById('familyForm');
                const editId = form.dataset.editId;
                
                // ุชุฌููุน ุจูุงูุงุช ุงูุงุณู
                const firstName = document.getElementById('familyFirstName').value.trim();
                const middleName = document.getElementById('familyMiddleName').value.trim();
                const lastName = document.getElementById('familyLastName').value.trim();
                
                let fullName = firstName;
                if (middleName) fullName += ` ${middleName}`;
                if (lastName) fullName += ` ${lastName}`;
                
                const memberData = {
                    full_name: fullName,
                    first_name: firstName,
                    middle_name: middleName,
                    last_name: lastName,
                    father_id: document.getElementById('familyFatherId').value || null,
                    membership_type: document.getElementById('familyMembershipType').value,
                    gender: document.getElementById('familyGender').value,
                    birth_date: document.getElementById('familyBirthDate').value || null,
                    birth_place: document.getElementById('familyBirthPlace').value.trim(),
                    profession: document.getElementById('familyProfession').value.trim(),
                    specialization: document.getElementById('familySpecialization').value.trim(),
                    phone: document.getElementById('familyPhone').value.trim(),
                    email: document.getElementById('familyEmail').value.trim(),
                    hobbies: document.getElementById('familyHobbies').value.trim()
                };
                
                // ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุทููุจุฉ
                if (!firstName || !lastName || !memberData.membership_type || !memberData.gender) {
                    this.showToast('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ: ุงูุงุณู ุงูุฃููุ ุงุณู ุงูุนุงุฆูุฉุ ููุน ุงูุนุถููุฉุ ูุงูุฌูุณ', 'error');
                    return;
                }

                // ุงูุชุญูู ูู ุตุญุฉ ุฑูู ุงูุฌูุงู (ุฅุฐุง ุชู ุฅุฏุฎุงูู)
                if (memberData.phone && !/^05\d{8}$/.test(memberData.phone)) {
                    this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุฌูุงู ุตุญูุญ ุจุตูุบุฉ 05xxxxxxxx', 'error');
                    return;
                }

                // ุงูุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุฅุฐุง ุชู ุฅุฏุฎุงูู)
                if (memberData.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(memberData.email)) {
                    this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุจุฑูุฏ ุฅููุชุฑููู ุตุญูุญ', 'error');
                    return;
                }
                
                try {
                    if (editId) {
                        // ุชุนุฏูู ุนุถู ููุฌูุฏ
                        this.dataManager.updateItem('familyMembers', editId, memberData);
                        this.showToast('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุนุถู ุจูุฌุงุญ', 'success');
                    } else {
                        // ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ
                        const newMember = this.dataManager.addItem('familyMembers', memberData);
                        this.showToast(`ุชู ุฅุถุงูุฉ ${memberData.full_name} ููุฌูู ${newMember.generation} ุจูุฌุงุญ!`, 'success');
                    }
                    
                    this.hideFamilyModal();
                    delete form.dataset.editId;
                    
                } catch (error) {
                    this.showToast('ุญุฏุซ ุฎุทุฃ: ' + error.message, 'error');
                }
            }

            hideFamilyModal() {
                document.getElementById('familyModal').classList.add('hidden');
                document.getElementById('familyForm').reset();
                this.updateFullNamePreview();
                this.updateGenerationDisplay();
            }

            resetFamilyForm() {
                if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุจูุงูุงุชุ')) {
                    document.getElementById('familyForm').reset();
                    delete document.getElementById('familyForm').dataset.editId;
                    this.updateFullNamePreview();
                    this.updateGenerationDisplay();
                    this.showToast('ุชู ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ', 'warning');
                }
            }

            // ูุธุงุฆู ุงูุฃุญุฏุงุซ ูุงูุฃูุณุงู ุงูุฃุฎุฑู (ูุจุณุทุฉ)
            displayEvents() {
                const events = this.dataManager.getData('events');
                const container = document.getElementById('events-grid');
                if (!container) return;

                if (events.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl text-white mb-4 opacity-50">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <p class="text-white text-xl mb-4">ูุง ุชูุฌุฏ ุฃุญุฏุงุซ</p>
                            <button onclick="loadSampleData()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                                ุชุญููู ุจูุงูุงุช ูููุฐุฌูุฉ
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = events.map(event => `
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">${event.title}</h3>
                        <p class="text-gray-600 mb-4">${event.description}</p>
                        <div class="space-y-2 text-sm text-gray-500">
                            <div><i class="fas fa-calendar ml-2"></i>${event.date}</div>
                            <div><i class="fas fa-clock ml-2"></i>${event.time || 'ุบูุฑ ูุญุฏุฏ'}</div>
                            <div><i class="fas fa-map-marker-alt ml-2"></i>${event.location}</div>
                            <div><i class="fas fa-users ml-2"></i>${event.attendees || 0} ูุดุงุฑู</div>
                        </div>
                    </div>
                `).join('');
            }

            displaySuggestions() {
                const suggestions = this.dataManager.getData('suggestions');
                const container = document.getElementById('suggestions-grid');
                if (!container) return;

                if (suggestions.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl text-white mb-4 opacity-50">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <p class="text-white text-xl mb-4">ูุง ุชูุฌุฏ ุงูุชุฑุงุญุงุช</p>
                            <button onclick="loadSampleData()" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700">
                                ุชุญููู ุจูุงูุงุช ูููุฐุฌูุฉ
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = suggestions.map(suggestion => `
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">${suggestion.title}</h3>
                        <p class="text-gray-600 mb-4">${suggestion.description}</p>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                                <span class="text-green-600">
                                    <i class="fas fa-thumbs-up ml-1"></i>
                                    ${suggestion.upvotes || 0}
                                </span>
                                <span class="text-red-600">
                                    <i class="fas fa-thumbs-down ml-1"></i>
                                    ${suggestion.downvotes || 0}
                                </span>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700">
                                ${suggestion.category}
                            </span>
                        </div>
                    </div>
                `).join('');
            }

            displayLibrary() {
                const library = this.dataManager.getData('library');
                const container = document.getElementById('library-grid');
                if (!container) return;

                if (library.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl text-white mb-4 opacity-50">
                                <i class="fas fa-book"></i>
                            </div>
                            <p class="text-white text-xl mb-4">ูุง ุชูุฌุฏ ูุญุชููุงุช ูู ุงูููุชุจุฉ</p>
                            <button onclick="loadSampleData()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">
                                ุชุญููู ุจูุงูุงุช ูููุฐุฌูุฉ
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = library.map(item => `
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">${item.title}</h3>
                        <p class="text-gray-600 mb-2">ุจููู: ${item.author}</p>
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${(item.tags || []).map(tag => `
                                <span class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded-full">${tag}</span>
                            `).join('')}
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700">
                                ${item.category}
                            </span>
                            <i class="fas fa-file text-2xl text-gray-400"></i>
                        </div>
                    </div>
                `).join('');
            }

            // ุงูุฑุณูู ุงูุจูุงููุฉ
            initializeCharts() {
                this.createMembershipChart();
                this.createActivityChart();
            }

            createMembershipChart() {
                const ctx = document.getElementById('membershipChart');
                if (!ctx) return;

                const familyMembers = this.dataManager.getData('familyMembers');
                const membershipData = {};
                
                familyMembers.forEach(member => {
                    const type = this.getMembershipTypeText(member.membership_type).replace(/[๐๏ธ๐๐ฅ๐จโ๐ฉโ๐งโ๐ฆ๐๐]/g, '').trim();
                    membershipData[type] = (membershipData[type] || 0) + 1;
                });

                if (this.charts.membership) {
                    this.charts.membership.destroy();
                }

                this.charts.membership = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(membershipData),
                        datasets: [{
                            data: Object.values(membershipData),
                            backgroundColor: [
                                '#fbbf24', // amber
                                '#ef4444', // red
                                '#3b82f6', // blue
                                '#10b981', // green
                                '#6b7280', // gray
                                '#8b5cf6'  // purple
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createActivityChart() {
                const ctx = document.getElementById('activityChart');
                if (!ctx) return;

                // ุจูุงูุงุช ูููุฐุฌูุฉ ูููุดุงุท ุงูุดูุฑู
                const monthlyData = [12, 19, 15, 22, 28, 18, 25, 20, 16, 24, 30, 22];
                const months = ['ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู', 
                              'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'];

                if (this.charts.activity) {
                    this.charts.activity.destroy();
                }

                this.charts.activity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'ุงููุดุงุท ุงูุดูุฑู',
                            data: monthlyData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            updateCharts() {
                this.createMembershipChart();
                // ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ุฑุณู ุงููุดุงุท ูุฃูู ูุญุชูู ุนูู ุจูุงูุงุช ุซุงุจุชุฉ
            }

            // ูุธุงุฆู ูุณุงุนุฏุฉ
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 4000);
            }

            // ุฅูุดุงุก ุงูููุงุฐุฌ (ูุจุณุท)
            createModals() {
                // ุชุชู ุฅุถุงูุฉ ุงูููุงุฐุฌ ูู HTML
            }

            // ุชุญููู ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ
            loadSampleData() {
                try {
                    this.dataManager.loadSampleData();
                    
                    // ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุญููุฉ
                    const totalMembers = this.dataManager.getData('familyMembers').length;
                    const secondGen = this.dataManager.getData('familyMembers').filter(m => m.generation === 2);
                    
                    this.showToast(
                        `โ ุชู ุชุญููู ุงูุจูุงูุงุช ุงููููุฐุฌูุฉ ุจูุฌุงุญ!\n๐ณ ุฅุฌูุงูู ุงูุฃุนุถุงุก: ${totalMembers}\n๐ฅ ุงูุฌูู ุงูุซุงูู: ${secondGen.length} ุฃุนุถุงุก`, 
                        'success'
                    );
                    
                    this.refreshAllSections();
                    
                    // ุงูุชุจุฏูู ุฅูู ูุณู ุงูุดุฌุฑุฉ ุงูุนุงุฆููุฉ ูุฅุธูุงุฑ ุงููุชุงุฆุฌ
                    setTimeout(() => {
                        showSection('family');
                    }, 1500);
                    
                } catch (error) {
                    this.showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุงูุจูุงูุงุช: ' + error.message, 'error');
                }
            }
        }

        // ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
        let app;

        // ุชููุฆุฉ ุงูุชุทุจูู
        document.addEventListener('DOMContentLoaded', function() {
            try {
                app = new EnhancedAlSaedanApp();
                console.log('โ ุชู ุชุญููู ุงูุชุทุจูู ุงูุดุงูู ุงููุญุณู ุจูุฌุงุญ');
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชููุฆุฉ ุงูุชุทุจูู:', error);
            }
        });

        // ูุธุงุฆู ุงูุชููู
        function showSection(sectionName) {
            // ุฅุฒุงูุฉ ุงููุฆุฉ ุงููุดุทุฉ ูู ุฌููุน ุงูุฃูุณุงู
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ุฅุธูุงุฑ ุงููุณู ุงููุทููุจ
            const targetSection = document.getElementById(`${sectionName}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // ุชูุนูู ุฒุฑ ุงูุชููู
            const navButton = document.getElementById(`nav-${sectionName}`);
            if (navButton) {
                navButton.classList.add('active');
            }

            // ุชุญุฏูุซ ุงูุฑุณูู ุงูุจูุงููุฉ ุฅุฐุง ูุงู ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
            if (sectionName === 'home' && app) {
                setTimeout(() => {
                    app.updateCharts();
                }, 100);
            }
        }

        // ูุธุงุฆู ุงูุนุงุฆูุฉ
        function loadFounderFamily() {
            if (app) {
                app.loadSampleData();
            }
        }

        function loadSampleData() {
            if (app) {
                app.loadSampleData();
            }
        }

        function showFamilyModal(memberId = null) {
            if (app) {
                app.showFamilyModal(memberId);
            }
        }

        function hideFamilyModal() {
            if (app) {
                app.hideFamilyModal();
            }
        }

        function resetFamilyForm() {
            if (app) {
                app.resetFamilyForm();
            }
        }

        function editFamilyMember(id) {
            if (app) {
                app.showFamilyModal(id);
            }
        }

        function deleteFamilyMember(id) {
            if (!app) return;
            
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุนุถูุ')) {
                try {
                    app.dataManager.deleteItem('familyMembers', id);
                    app.showToast('ุชู ุญุฐู ุงูุนุถู ุจูุฌุงุญ', 'success');
                } catch (error) {
                    app.showToast('ุญุฏุซ ุฎุทุฃ: ' + error.message, 'error');
                }
            }
        }

        // ูุธุงุฆู ุงูููุงุฐุฌ ุงูุฃุฎุฑู (ูุจุณุทุฉ)
        function showEventModal() {
            alert('ูููุฐุฌ ุงูุฃุญุฏุงุซ - ูุฑูุจุงู');
        }

        function showSuggestionModal() {
            alert('ูููุฐุฌ ุงูุงูุชุฑุงุญุงุช - ูุฑูุจุงู');
        }

        function showLibraryModal() {
            alert('ูููุฐุฌ ุงูููุชุจุฉ - ูุฑูุจุงู');
        }

        // ูุธููุฉ ุงุฎุชุจุงุฑ ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุฌูู ุงูุซุงูู
        function testSecondGenerationRetrieval() {
            if (!app) {
                alert('ุงูุชุทุจูู ุบูุฑ ูููุฃ ุจุนุฏ');
                return;
            }

            try {
                console.log('๐งช ุงุฎุชุจุงุฑ ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงูุฌูู ุงูุซุงูู...');
                
                const allMembers = app.dataManager.getData('familyMembers');
                const firstGeneration = allMembers.filter(m => m.generation === 1);
                const secondGeneration = allMembers.filter(m => m.generation === 2);
                const thirdGeneration = allMembers.filter(m => m.generation === 3);

                let testResults = `๐ ูุชุงุฆุฌ ุงุฎุชุจุงุฑ ุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช:\n\n`;
                testResults += `๐ ุฅุฌูุงูู ุงูุฃุนุถุงุก: ${allMembers.length}\n`;
                testResults += `๐ ุงูุฌูู ุงูุฃูู (ุงููุคุณุณูู): ${firstGeneration.length}\n`;
                testResults += `๐ฅ ุงูุฌูู ุงูุซุงูู: ${secondGeneration.length}\n`;
                testResults += `๐ถ ุงูุฌูู ุงูุซุงูุซ: ${thirdGeneration.length}\n\n`;

                if (secondGeneration.length > 0) {
                    testResults += `โ ุชู ุงูุนุซูุฑ ุนูู ุงูุฌูู ุงูุซุงูู ุจูุฌุงุญ:\n`;
                    secondGeneration.forEach((member, index) => {
                        const father = allMembers.find(m => m.id === member.father_id);
                        testResults += `${index + 1}. ${member.full_name}\n`;
                        testResults += `   - ุงูุฌูู: ${member.generation}\n`;
                        testResults += `   - ุงููุงูุฏ: ${father ? father.full_name : 'ุบูุฑ ูุญุฏุฏ'}\n`;
                        testResults += `   - ุงูุนุถููุฉ: ${app.getMembershipTypeText(member.membership_type)}\n\n`;
                    });
                    
                    // ุงุฎุชุจุงุฑ ุงูุฑูุงุจุท ุงูุนุงุฆููุฉ
                    testResults += `๐ ุงุฎุชุจุงุฑ ุงูุฑูุงุจุท ุงูุนุงุฆููุฉ:\n`;
                    firstGeneration.forEach(founder => {
                        const children = allMembers.filter(m => m.father_id === founder.id);
                        testResults += `- ${founder.full_name}: ${children.length} ูู ุงูุฃุทูุงู\n`;
                    });

                    app.showToast('โ ุงุฎุชุจุงุฑ ุงูุฌูู ุงูุซุงูู ูุฌุญ! ุฑุงุฌุน ูุญุฏุฉ ุงูุชุญูู ููุชูุงุตูู.', 'success');
                } else {
                    testResults += `โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุนุถุงุก ูู ุงูุฌูู ุงูุซุงูู\n`;
                    testResults += `๐ก ุชุฃูุฏ ูู ุชุญููู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุฃููุงู`;
                    
                    app.showToast('โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุฌูู ุงูุซุงูู. ุญููู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุฃููุงู.', 'warning');
                }

                console.log(testResults);
                alert(testResults);

            } catch (error) {
                const errorMsg = `โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช: ${error.message}`;
                console.error(errorMsg);
                app.showToast(errorMsg, 'error');
            }
        }

        // ูุณุชูุนู ุงูุฃุญุฏุงุซ
        document.addEventListener('click', function(e) {
            if (e.target.id === 'familyModal') {
                hideFamilyModal();
            }
        });
    </script>
</body>
</html>