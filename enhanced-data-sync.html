<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† - Ø¢Ù„ Ø³Ø¹ÙŠØ¯Ø§Ù†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .sync-status {
            transition: all 0.3s ease;
        }
        .sync-success {
            background: linear-gradient(45deg, #10b981, #34d399);
        }
        .sync-warning {
            background: linear-gradient(45deg, #f59e0b, #fbbf24);
        }
        .sync-error {
            background: linear-gradient(45deg, #ef4444, #f87171);
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container { padding: 8px; }
            .grid { grid-template-columns: 1fr !important; }
            .text-base { font-size: 0.9rem; }
            .p-6 { padding: 1rem; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">
                <i class="fas fa-sync-alt mr-3 pulse-animation"></i>
                Ù†Ø¸Ø§Ù… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†
            </h1>
            <p class="text-white text-lg opacity-90">
                Ø­Ù„ Ø´Ø§Ù…Ù„ Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
            </p>
        </div>

        <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div id="systemStatus" class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i id="statusIcon" class="fas fa-circle-notch fa-spin text-blue-600 mr-3"></i>
                Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            </h3>
            <div id="statusMessage" class="text-gray-700 text-base">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-desktop text-blue-600 mr-2"></i>
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                </h3>
                
                <div id="currentData" class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©:</span>
                        <span id="currentFamilyCount" class="font-bold text-blue-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</span>
                        <span id="currentEventsCount" class="font-bold text-green-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</span>
                        <span id="currentSuggestionsCount" class="font-bold text-yellow-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ù…ÙƒØªØ¨Ø©:</span>
                        <span id="currentLibraryCount" class="font-bold text-purple-600">--</span>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø© -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-cloud text-green-600 mr-2"></i>
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©
                </h3>
                
                <div id="syncedData" class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©:</span>
                        <span id="syncedFamilyCount" class="font-bold text-blue-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</span>
                        <span id="syncedEventsCount" class="font-bold text-green-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</span>
                        <span id="syncedSuggestionsCount" class="font-bold text-yellow-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ù…ÙƒØªØ¨Ø©:</span>
                        <span id="syncedLibraryCount" class="font-bold text-purple-600">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-tools text-orange-600 mr-2"></i>
                Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <button id="syncBtn" onclick="performDataSync()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-sync-alt mr-2"></i>
                    Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
                </button>
                
                <button id="backupBtn" onclick="createManualBackup()" 
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-save mr-2"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </button>
                
                <button id="restoreBtn" onclick="restoreFromBackup()" 
                        class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-undo mr-2"></i>
                    Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                
                <button id="resetBtn" onclick="resetAllData()" 
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-trash mr-2"></i>
                    Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="exportData()" 
                        class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-download mr-2"></i>
                    ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                
                <label class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors cursor-pointer text-center block">
                    <i class="fas fa-upload mr-2"></i>
                    Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    <input type="file" id="importFile" accept=".json" class="hidden" onchange="importData(event)">
                </label>
            </div>
        </div>

        <!-- Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-list text-gray-600 mr-2"></i>
                Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            </h3>
            <div id="operationsLog" class="bg-gray-50 rounded p-4 h-48 overflow-y-auto text-sm">
                <div class="text-gray-500 italic">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù‡Ù†Ø§...</div>
            </div>
        </div>

        <!-- Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ -->
        <div class="text-center mt-8">
            <a href="index.html" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-lg transition-colors inline-block">
                <i class="fas fa-arrow-right mr-2"></i>
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            </a>
        </div>
    </div>

    <script>
        // Ù†Ø¸Ø§Ù… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†
        class EnhancedDataSyncSystem {
            constructor() {
                this.logContainer = document.getElementById('operationsLog');
                this.statusIcon = document.getElementById('statusIcon');
                this.statusMessage = document.getElementById('statusMessage');
                this.statusContainer = document.getElementById('systemStatus');
                
                // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
                this.storageKeys = {
                    main: 'saedan_family_data',
                    backup: 'family_data_backup',
                    sync: 'family_data_sync',
                    export: 'family_data_export'
                };

                this.init();
            }

            init() {
                this.log('ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø­Ø³Ù†...');
                this.analyzeDataSources();
                this.updateDisplay();
                this.startPeriodicSync();
            }

            // ØªØ­Ù„ÙŠÙ„ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
            analyzeDataSources() {
                const sources = {
                    localStorage_main: this.getStorageData('localStorage', this.storageKeys.main),
                    localStorage_backup: this.getStorageData('localStorage', this.storageKeys.backup),
                    sessionStorage_main: this.getStorageData('sessionStorage', this.storageKeys.main),
                    sessionStorage_backup: this.getStorageData('sessionStorage', this.storageKeys.backup)
                };

                this.log('ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:');
                
                let bestSource = null;
                let maxFamilyCount = 0;

                Object.keys(sources).forEach(key => {
                    const data = sources[key];
                    const count = data ? (data.familyMembers?.length || 0) : 0;
                    this.log(`   - ${key}: ${count} Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø©`);
                    
                    if (count > maxFamilyCount) {
                        maxFamilyCount = count;
                        bestSource = { key, data };
                    }
                });

                if (bestSource && maxFamilyCount > 0) {
                    this.log(`âœ… Ø£ÙØ¶Ù„ Ù…ØµØ¯Ø± Ø¨ÙŠØ§Ù†Ø§Øª: ${bestSource.key} (${maxFamilyCount} Ø¹Ø¶Ùˆ)`);
                    this.syncAllSources(bestSource.data);
                    this.updateStatus('success', `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${maxFamilyCount} Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø© - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©`);
                } else {
                    this.log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª - ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                    this.loadDefaultData();
                    this.updateStatus('warning', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª - ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                }
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…ØµØ¯Ø± ØªØ®Ø²ÙŠÙ† Ù…Ø­Ø¯Ø¯
            getStorageData(storageType, key) {
                try {
                    const storage = storageType === 'localStorage' ? localStorage : sessionStorage;
                    const dataStr = storage.getItem(key);
                    if (dataStr) {
                        const parsed = JSON.parse(dataStr);
                        return parsed.data || parsed; // Ø¯Ø¹Ù… Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
                    }
                } catch (error) {
                    this.log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ${storageType}.${key}: ${error.message}`);
                }
                return null;
            }

            // Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†
            syncAllSources(masterData) {
                try {
                    const syncData = {
                        data: masterData,
                        timestamp: new Date().toISOString(),
                        version: '2.0',
                        device: this.getDeviceInfo(),
                        source: 'enhanced_sync_system'
                    };

                    // Ø­ÙØ¸ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†
                    localStorage.setItem(this.storageKeys.main, JSON.stringify(masterData));
                    localStorage.setItem(this.storageKeys.backup, JSON.stringify(syncData));
                    sessionStorage.setItem(this.storageKeys.main, JSON.stringify(masterData));
                    sessionStorage.setItem(this.storageKeys.backup, JSON.stringify(syncData));

                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ÙØ¸ ÙÙŠ IndexedDB
                    this.saveToIndexedDB(syncData);

                    this.log('âœ… ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                    return true;
                } catch (error) {
                    this.log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${error.message}`);
                    return false;
                }
            }

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            loadDefaultData() {
                const defaultData = {
                    familyMembers: [
                        {
                            id: 1,
                            full_name: "Ø³Ù„Ù…Ø§Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹ÙŠØ¯Ø§Ù†",
                            generation: 1,
                            gender: "Ø°ÙƒØ±",
                            birth_year: 1975,
                            children_ids: [],
                            father_id: null,
                            mother_id: null,
                            phone: "+966533361154",
                            email: "info@salmansaedan.com",
                            occupation: "Ù…Ø·ÙˆØ± Ø¹Ù‚Ø§Ø±ÙŠ"
                        }
                    ],
                    events: [],
                    suggestions: [],
                    library: []
                };

                this.syncAllSources(defaultData);
                this.log('ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
            getDeviceInfo() {
                return {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    screenWidth: window.screen.width,
                    screenHeight: window.screen.height,
                    deviceType: window.innerWidth <= 768 ? 'mobile' : 'desktop'
                };
            }

            // Ø­ÙØ¸ ÙÙŠ IndexedDB
            async saveToIndexedDB(data) {
                try {
                    const request = indexedDB.open('AlSaedanFamilyDB', 1);
                    
                    request.onupgradeneeded = (e) => {
                        const db = e.target.result;
                        if (!db.objectStoreNames.contains('familyData')) {
                            db.createObjectStore('familyData', { keyPath: 'id' });
                        }
                    };

                    request.onsuccess = (e) => {
                        const db = e.target.result;
                        const tx = db.transaction(['familyData'], 'readwrite');
                        const store = tx.objectStore('familyData');
                        store.put({ id: 'main_sync', ...data });
                        this.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ IndexedDB');
                    };
                } catch (error) {
                    this.log(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ IndexedDB: ${error.message}`);
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            updateDisplay() {
                const currentData = this.getStorageData('localStorage', this.storageKeys.main) || {};
                const syncData = this.getStorageData('localStorage', this.storageKeys.backup);
                
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                document.getElementById('currentFamilyCount').textContent = currentData.familyMembers?.length || 0;
                document.getElementById('currentEventsCount').textContent = currentData.events?.length || 0;
                document.getElementById('currentSuggestionsCount').textContent = currentData.suggestions?.length || 0;
                document.getElementById('currentLibraryCount').textContent = currentData.library?.length || 0;

                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©
                if (syncData && syncData.data) {
                    document.getElementById('syncedFamilyCount').textContent = syncData.data.familyMembers?.length || 0;
                    document.getElementById('syncedEventsCount').textContent = syncData.data.events?.length || 0;
                    document.getElementById('syncedSuggestionsCount').textContent = syncData.data.suggestions?.length || 0;
                    document.getElementById('syncedLibraryCount').textContent = syncData.data.library?.length || 0;
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            updateStatus(type, message) {
                this.statusContainer.className = `bg-white rounded-lg shadow-lg p-6 mb-8 sync-${type}`;
                
                const icons = {
                    success: 'fas fa-check-circle text-green-600',
                    warning: 'fas fa-exclamation-triangle text-yellow-600',
                    error: 'fas fa-times-circle text-red-600',
                    loading: 'fas fa-circle-notch fa-spin text-blue-600'
                };

                this.statusIcon.className = icons[type] + ' mr-3';
                this.statusMessage.textContent = message;
            }

            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
            startPeriodicSync() {
                setInterval(() => {
                    this.analyzeDataSources();
                    this.updateDisplay();
                }, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©

                this.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©)');
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            log(message) {
                const timestamp = new Date().toLocaleTimeString('ar-SA');
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;
                
                this.logContainer.insertBefore(logEntry, this.logContainer.firstChild);
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 50 Ø¹Ù…Ù„ÙŠØ© ÙÙ‚Ø·
                while (this.logContainer.children.length > 50) {
                    this.logContainer.removeChild(this.logContainer.lastChild);
                }
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…
        const syncSystem = new EnhancedDataSyncSystem();

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„
        function performDataSync() {
            syncSystem.log('ğŸ”„ Ø¨Ø¯Ø¡ Ù…Ø²Ø§Ù…Ù†Ø© ÙŠØ¯ÙˆÙŠØ©...');
            syncSystem.updateStatus('loading', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
            
            setTimeout(() => {
                syncSystem.analyzeDataSources();
                syncSystem.updateDisplay();
                syncSystem.updateStatus('success', 'ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­');
            }, 1000);
        }

        function createManualBackup() {
            syncSystem.log('ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙŠØ¯ÙˆÙŠØ©...');
            const currentData = syncSystem.getStorageData('localStorage', syncSystem.storageKeys.main);
            
            if (currentData) {
                syncSystem.syncAllSources(currentData);
                syncSystem.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                syncSystem.updateStatus('success', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
            } else {
                syncSystem.log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                syncSystem.updateStatus('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
            }
        }

        function restoreFromBackup() {
            syncSystem.log('ğŸ”„ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
            const backupData = syncSystem.getStorageData('localStorage', syncSystem.storageKeys.backup);
            
            if (backupData && backupData.data) {
                syncSystem.syncAllSources(backupData.data);
                syncSystem.updateDisplay();
                syncSystem.log('âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                syncSystem.updateStatus('success', 'ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
            } else {
                syncSystem.log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ§Ù„Ø­Ø©');
                syncSystem.updateStatus('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ§Ù„Ø­Ø©');
            }
        }

        function resetAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                syncSystem.log('ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                
                // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ®Ø²ÙŠÙ†
                Object.values(syncSystem.storageKeys).forEach(key => {
                    localStorage.removeItem(key);
                    sessionStorage.removeItem(key);
                });

                syncSystem.loadDefaultData();
                syncSystem.updateDisplay();
                syncSystem.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                syncSystem.updateStatus('warning', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            }
        }

        function exportData() {
            const data = syncSystem.getStorageData('localStorage', syncSystem.storageKeys.main);
            if (data) {
                const exportData = {
                    data: data,
                    timestamp: new Date().toISOString(),
                    version: '2.0',
                    source: 'manual_export'
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `al-saedan-family-data-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                syncSystem.log('ğŸ“¥ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                syncSystem.updateStatus('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        const data = importedData.data || importedData;
                        
                        if (data.familyMembers && Array.isArray(data.familyMembers)) {
                            syncSystem.syncAllSources(data);
                            syncSystem.updateDisplay();
                            syncSystem.log(`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${data.familyMembers.length} Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø©`);
                            syncSystem.updateStatus('success', `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ (${data.familyMembers.length} Ø¹Ø¶Ùˆ)`);
                        } else {
                            throw new Error('ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­');
                        }
                    } catch (error) {
                        syncSystem.log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`);
                        syncSystem.updateStatus('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù');
                    }
                };
                reader.readAsText(file);
            }
        }
    </script>
</body>
</html>