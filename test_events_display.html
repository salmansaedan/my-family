<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h1 class="text-3xl font-bold text-center mb-8">
                <i class="fas fa-calendar-alt text-green-600 ml-2"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            </h1>
            
            <div class="text-center mb-6">
                <button onclick="loadEventsTest()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-sync ml-2"></i>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                </button>
            </div>
            
            <!-- Events Display Area -->
            <div id="events-container">
                <!-- Loading State -->
                <div id="events-loading" class="text-center py-12">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-500">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...</p>
                </div>
                
                <!-- Events List -->
                <div id="events-list" class="hidden space-y-4"></div>
                
                <!-- Empty State -->
                <div id="events-empty" class="hidden text-center py-12">
                    <i class="fas fa-calendar-plus text-gray-400 text-6xl mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-600 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                    <p class="text-gray-500 mb-6">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø­Ø¯Ø« Ù„Ù„Ø¹Ø§Ø¦Ù„Ø©</p>
                </div>
            </div>
            
            <!-- Events Statistics -->
            <div id="events-stats" class="hidden mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-blue-600" id="total-events">0</div>
                    <div class="text-sm text-blue-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</div>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-600" id="upcoming-events">0</div>
                    <div class="text-sm text-green-700">Ø£Ø­Ø¯Ø§Ø« Ù‚Ø§Ø¯Ù…Ø©</div>
                </div>
                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-yellow-600" id="this-month-events">0</div>
                    <div class="text-sm text-yellow-700">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-purple-600" id="high-priority-events">0</div>
                    <div class="text-sm text-purple-700">Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©</div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script>
        // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        async function loadEventsTest() {
            console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...');
            
            try {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                const loadingEl = document.getElementById('events-loading');
                const listEl = document.getElementById('events-list');
                const emptyEl = document.getElementById('events-empty');
                const statsEl = document.getElementById('events-stats');
                
                if (loadingEl) loadingEl.classList.remove('hidden');
                if (listEl) listEl.classList.add('hidden');
                if (emptyEl) emptyEl.classList.add('hidden');
                if (statsEl) statsEl.classList.add('hidden');
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API
                const response = await fetch('/api/events');
                const result = await response.json();
                
                console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© API:', result);
                
                if (result.status === 'success' && result.data) {
                    const events = result.data;
                    console.log(\`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ \${events.length} Ø­Ø¯Ø«\`);
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    if (loadingEl) loadingEl.classList.add('hidden');
                    
                    if (events.length === 0) {
                        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ©
                        if (emptyEl) emptyEl.classList.remove('hidden');
                    } else {
                        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                        if (listEl) {
                            listEl.innerHTML = '';
                            events.forEach(event => {
                                listEl.appendChild(createEventCard(event));
                            });
                            listEl.classList.remove('hidden');
                        }
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                        updateEventsStats(events);
                        if (statsEl) statsEl.classList.remove('hidden');
                    }
                } else {
                    throw new Error(result.message || 'Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
                const loadingEl = document.getElementById('events-loading');
                if (loadingEl) {
                    loadingEl.innerHTML = \`
                        <div class="text-center py-12">
                            <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                            <p class="text-red-600 font-semibold">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</p>
                            <p class="text-gray-500 text-sm mt-1">\${error.message}</p>
                            <button onclick="loadEventsTest()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                                <i class="fas fa-redo ml-1"></i>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </div>
                    \`;
                }
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø­Ø¯Ø«
        function createEventCard(event) {
            console.log('ğŸ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø­Ø¯Ø«:', event.title);
            
            const card = document.createElement('div');
            card.className = 'bg-gradient-to-r from-white to-gray-50 border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all';
            
            // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
            const priorityColors = {
                'low': 'text-gray-500 bg-gray-100',
                'medium': 'text-blue-600 bg-blue-100', 
                'high': 'text-orange-600 bg-orange-100',
                'urgent': 'text-red-600 bg-red-100'
            };
            
            const priorityLabels = {
                'low': 'Ù…Ù†Ø®ÙØ¶Ø©',
                'medium': 'Ù…ØªÙˆØ³Ø·Ø©',
                'high': 'Ø¹Ø§Ù„ÙŠØ©', 
                'urgent': 'Ø¹Ø§Ø¬Ù„Ø©'
            };
            
            // ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù†ÙˆØ¹
            const typeIcons = {
                'meeting': 'fas fa-users',
                'celebration': 'fas fa-birthday-cake',
                'educational': 'fas fa-graduation-cap',
                'recreational': 'fas fa-gamepad',
                'business': 'fas fa-briefcase',
                'religious': 'fas fa-mosque',
                'general': 'fas fa-calendar'
            };
            
            const typeLabels = {
                'meeting': 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¹Ø§Ø¦Ù„ÙŠ',
                'celebration': 'Ø§Ø­ØªÙØ§Ù„ ÙˆÙ…Ù†Ø§Ø³Ø¨Ø©',
                'educational': 'ÙØ¹Ø§Ù„ÙŠØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©',
                'recreational': 'ÙØ¹Ø§Ù„ÙŠØ© ØªØ±ÙÙŠÙ‡ÙŠØ©',
                'business': 'ÙØ¹Ø§Ù„ÙŠØ© ØªØ¬Ø§Ø±ÙŠØ©',
                'religious': 'Ù…Ù†Ø§Ø³Ø¨Ø© Ø¯ÙŠÙ†ÙŠØ©',
                'general': 'Ø¹Ø§Ù…'
            };
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
            const eventDate = new Date(event.event_date);
            const formattedDate = eventDate.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            const formattedTime = eventDate.toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            card.innerHTML = \`
                <div class="flex justify-between items-start mb-4">
                    <div class="flex-1">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">
                            <i class="\${typeIcons[event.event_type] || 'fas fa-calendar'} text-green-600 ml-2"></i>
                            \${event.title || 'Ø­Ø¯Ø« Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}
                        </h3>
                        <p class="text-gray-600 text-sm">\${typeLabels[event.event_type] || 'Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    <div class="text-left">
                        <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold \${priorityColors[event.priority] || priorityColors['medium']}">
                            \${priorityLabels[event.priority] || 'Ù…ØªÙˆØ³Ø·Ø©'}
                        </span>
                    </div>
                </div>
                
                <div class="space-y-3 mb-4">
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-calendar-day text-blue-500 ml-3 w-5"></i>
                        <span class="font-medium">\${formattedDate}</span>
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-clock text-green-500 ml-3 w-5"></i>
                        <span>\${formattedTime}</span>
                    </div>
                    \${event.location ? \`
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-map-marker-alt text-red-500 ml-3 w-5"></i>
                            <span>\${event.location}</span>
                        </div>
                    \` : ''}
                    \${event.organizer_name ? \`
                        <div class="flex items-center text-gray-600">
                            <i class="fas fa-user-tie text-purple-500 ml-3 w-5"></i>
                            <span>Ø§Ù„Ù…Ù†Ø¸Ù…: \${event.organizer_name}</span>
                            \${event.organizer_phone ? \`<span class="text-gray-500 mr-2">(\${event.organizer_phone})</span>\` : ''}
                        </div>
                    \` : ''}
                </div>
                
                \${event.description ? \`
                    <div class="bg-gray-50 rounded-lg p-3 mb-4">
                        <p class="text-gray-700 text-sm">\${event.description}</p>
                    </div>
                \` : ''}
                
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <div class="flex space-x-2 space-x-reverse">
                        \${event.max_attendees ? \`
                            <span class="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">
                                <i class="fas fa-users ml-1"></i>
                                Ø­Ø¯ Ø£Ù‚ØµÙ‰: \${event.max_attendees}
                            </span>
                        \` : ''}
                        \${event.estimated_cost ? \`
                            <span class="inline-flex items-center px-2 py-1 bg-green-100 text-green-700 text-xs rounded">
                                <i class="fas fa-money-bill ml-1"></i>
                                \${event.estimated_cost} Ø±ÙŠØ§Ù„
                            </span>
                        \` : ''}
                    </div>
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="alert('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø«: ' + '\${event.title}')" class="text-blue-600 hover:text-blue-800 p-2 rounded" title="ØªØ¹Ø¯ÙŠÙ„">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="alert('Ø­Ø°Ù Ø§Ù„Ø­Ø¯Ø«: ' + '\${event.title}')" class="text-red-600 hover:text-red-800 p-2 rounded" title="Ø­Ø°Ù">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            \`;
            
            return card;
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function updateEventsStats(events) {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            const totalEvents = events.length;
            
            // Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            const upcomingEvents = events.filter(event => {
                const eventDate = new Date(event.event_date);
                return eventDate > now;
            }).length;
            
            // Ø£Ø­Ø¯Ø§Ø« Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
            const thisMonthEvents = events.filter(event => {
                const eventDate = new Date(event.event_date);
                return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
            }).length;
            
            // Ø£Ø­Ø¯Ø§Ø« Ø¨Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©
            const highPriorityEvents = events.filter(event => 
                event.priority === 'high' || event.priority === 'urgent'
            ).length;
            
            console.log(\`ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹=\${totalEvents}, Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©=\${upcomingEvents}, Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±=\${thisMonthEvents}, Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©=\${highPriorityEvents}\`);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
            const totalEl = document.getElementById('total-events');
            const upcomingEl = document.getElementById('upcoming-events');
            const thisMonthEl = document.getElementById('this-month-events');
            const highPriorityEl = document.getElementById('high-priority-events');
            
            if (totalEl) totalEl.textContent = totalEvents;
            if (upcomingEl) upcomingEl.textContent = upcomingEvents;
            if (thisMonthEl) thisMonthEl.textContent = thisMonthEvents;
            if (highPriorityEl) highPriorityEl.textContent = highPriorityEvents;
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            console.log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø«');
            loadEventsTest();
        };
    </script>
</body>
</html>