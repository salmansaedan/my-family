<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فحص المستخدمين - اختبار</title>
</head>
<body>
    <h1>فحص وإضافة المستخدمين التجريبيين</h1>
    <div id="results"></div>
    
    <script>
        console.log("=== فحص المستخدمين في localStorage ===");

        // الحصول على المستخدمين من localStorage
        const stored = localStorage.getItem('al_saedan_users_v1');
        let users = [];

        if (stored) {
            try {
                users = JSON.parse(stored);
                console.log(`عدد المستخدمين المحفوظين: ${users.length}`);
                
                // تصنيف المستخدمين حسب الحالة
                const activeUsers = users.filter(u => u.status === 'active');
                const pendingUsers = users.filter(u => u.status === 'pending');
                const otherUsers = users.filter(u => u.status !== 'active' && u.status !== 'pending');
                
                console.log(`المستخدمون المفعلون: ${activeUsers.length}`);
                console.log(`المستخدمون في الانتظار: ${pendingUsers.length}`);
                console.log(`مستخدمون آخرون: ${otherUsers.length}`);
                
                // طباعة تفاصيل المستخدمين المعلقين
                if (pendingUsers.length > 0) {
                    console.log("\n🔸 المستخدمون في الانتظار:");
                    pendingUsers.forEach((user, index) => {
                        console.log(`${index + 1}. ${user.full_name} - ${user.email} - ${user.status}`);
                    });
                } else {
                    console.log("\n✅ لا يوجد مستخدمون في حالة الانتظار");
                }
                
                // طباعة تفاصيل المستخدمين المفعلين
                if (activeUsers.length > 0) {
                    console.log("\n🔸 المستخدمون المفعلون:");
                    activeUsers.forEach((user, index) => {
                        console.log(`${index + 1}. ${user.full_name} - ${user.email} - ${user.role || 'user'}`);
                    });
                }
            } catch (error) {
                console.error('خطأ في قراءة بيانات المستخدمين:', error);
            }
        } else {
            console.log("لا توجد بيانات مستخدمين محفوظة");
        }

        // إنشاء مستخدم تجريبي في حالة الانتظار
        function createTestPendingUser() {
            console.log("\n=== إضافة مستخدم تجريبي في الانتظار ===");
            
            const testUser = {
                id: 'test_user_' + Date.now(),
                national_id: '1234567890',
                first_name: 'أحمد',
                middle_name: 'علي',
                last_name: 'السعيدان',
                full_name: 'أحمد علي السعيدان',
                email: 'ahmed.test@example.com',
                phone: '0501234567',
                password: 'YWRtaW4xMjNzYWx0X2tleV8yMDI0', // password hash for 'test123'
                role: 'user',
                status: 'pending', // حالة الانتظار
                birth_date: '1990-05-15',
                birth_place: 'الرياض',
                profession: 'مهندس',
                specialization: 'هندسة البرمجيات',
                hobbies: 'القراءة، البرمجة',
                father_id: null,
                generation: 3,
                created_at: new Date().toISOString(),
                approved_at: null,
                approved_by: null
            };
            
            // إضافة المستخدم التجريبي
            users.push(testUser);
            localStorage.setItem('al_saedan_users_v1', JSON.stringify(users));
            
            console.log(`✅ تم إضافة المستخدم التجريبي: ${testUser.full_name}`);
            console.log(`   الحالة: ${testUser.status}`);
            console.log(`   البريد: ${testUser.email}`);
            
            return testUser;
        }

        // إنشاء مستخدم تجريبي
        const testUser = createTestPendingUser();

        console.log(`\nالإجمالي الحالي: ${users.length} مستخدم`);
        console.log("تم الانتهاء من فحص وإضافة المستخدمين التجريبيين");
        
        document.getElementById('results').innerHTML = `
            <p>تم إضافة مستخدم تجريبي: ${testUser.full_name}</p>
            <p>إجمالي المستخدمين: ${users.length}</p>
            <p>راجع الكونسول للمزيد من التفاصيل</p>
        `;
    </script>
</body>
</html>