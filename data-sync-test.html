<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø¢Ù„ Ø³Ø¹ÙŠØ¯Ø§Ù†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-white text-center mb-8">
            <i class="fas fa-sync-alt mr-2"></i>
            Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-desktop text-blue-600 mr-2"></i>
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²)
                </h3>
                
                <div id="localData" class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©:</span>
                        <span id="localFamilyCount" class="font-bold text-blue-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</span>
                        <span id="localEventsCount" class="font-bold text-green-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</span>
                        <span id="localSuggestionsCount" class="font-bold text-yellow-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ù…ÙƒØªØ¨Ø©:</span>
                        <span id="localLibraryCount" class="font-bold text-purple-600">--</span>
                    </div>
                </div>
                
                <div class="mt-6 space-y-3">
                    <button onclick="loadLocalData()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                        <i class="fas fa-refresh mr-2"></i>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    </button>
                    <button onclick="openMainApp()" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                        <i class="fas fa-external-link-alt mr-2"></i>ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                    </button>
                </div>
            </div>
            
            <!-- Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-cloud text-indigo-600 mr-2"></i>
                    Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </h3>
                
                <div id="backupData" class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©:</span>
                        <span id="backupFamilyCount" class="font-bold text-blue-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</span>
                        <span id="backupEventsCount" class="font-bold text-green-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</span>
                        <span id="backupSuggestionsCount" class="font-bold text-yellow-600">--</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span>Ø§Ù„Ù…ÙƒØªØ¨Ø©:</span>
                        <span id="backupLibraryCount" class="font-bold text-purple-600">--</span>
                    </div>
                    <div class="p-3 bg-blue-50 rounded">
                        <div class="text-sm text-gray-600">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</div>
                        <div id="backupDate" class="font-medium text-blue-800">--</div>
                    </div>
                </div>
                
                <div class="mt-6 space-y-3">
                    <button onclick="loadBackupData()" class="w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700">
                        <i class="fas fa-cloud-download-alt mr-2"></i>ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    </button>
                    <button onclick="compareData()" class="w-full bg-yellow-600 text-white py-2 px-4 rounded hover:bg-yellow-700">
                        <i class="fas fa-balance-scale mr-2"></i>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© -->
        <div id="comparisonResult" class="bg-white rounded-lg shadow-lg p-6 mt-8 hidden">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-chart-bar text-orange-600 mr-2"></i>
                Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
            </h3>
            <div id="comparisonContent"></div>
        </div>
        
        <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-tools text-gray-600 mr-2"></i>
                Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="createTestBackup()" class="bg-green-600 text-white py-3 px-4 rounded hover:bg-green-700">
                    <i class="fas fa-save mr-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </button>
                <button onclick="clearAllData()" class="bg-red-600 text-white py-3 px-4 rounded hover:bg-red-700">
                    <i class="fas fa-trash mr-2"></i>Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="exportBackup()" class="bg-purple-600 text-white py-3 px-4 rounded hover:bg-purple-700">
                    <i class="fas fa-file-export mr-2"></i>ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                </button>
            </div>
        </div>
        
        <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-8">
            <h4 class="font-bold text-blue-800 mb-3">ğŸ“‹ ÙƒÙŠÙÙŠØ© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</h4>
            <ol class="text-blue-700 space-y-2">
                <li class="flex items-start">
                    <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-2 mt-0.5">1</span>
                    <span>Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ù…ØªØµÙØ­</span>
                </li>
                <li class="flex items-start">
                    <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-2 mt-0.5">2</span>
                    <span>Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø£Ø¹Ø¶Ø§Ø¡ Ø¹Ø§Ø¦Ù„Ø©ØŒ Ø£Ø­Ø¯Ø§Ø«ØŒ Ø¥Ù„Ø®)</span>
                </li>
                <li class="flex items-start">
                    <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-2 mt-0.5">3</span>
                    <span>Ø§ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ù…ØªØµÙØ­ Ù…Ø®ØªÙ„Ù</span>
                </li>
                <li class="flex items-start">
                    <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-2 mt-0.5">4</span>
                    <span>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" ÙˆÙ‚Ø§Ø±Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</span>
                </li>
                <li class="flex items-start">
                    <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-2 mt-0.5">5</span>
                    <span>Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª</span>
                </li>
            </ol>
        </div>
    </div>

    <script>
        let localDataCache = {};
        let backupDataCache = {};

        function loadLocalData() {
            try {
                const familyData = JSON.parse(localStorage.getItem('al_saedan_family_data_v2') || '{"familyMembers":[],"events":[],"suggestions":[],"library":[]}');
                
                localDataCache = {
                    family: familyData.familyMembers?.length || 0,
                    events: familyData.events?.length || 0,
                    suggestions: familyData.suggestions?.length || 0,
                    library: familyData.library?.length || 0
                };
                
                document.getElementById('localFamilyCount').textContent = localDataCache.family;
                document.getElementById('localEventsCount').textContent = localDataCache.events;
                document.getElementById('localSuggestionsCount').textContent = localDataCache.suggestions;
                document.getElementById('localLibraryCount').textContent = localDataCache.library;
                
                console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', localDataCache);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©: ' + error.message);
            }
        }

        function loadBackupData() {
            try {
                const backupStr = localStorage.getItem('family_data_backup');
                if (backupStr) {
                    const backup = JSON.parse(backupStr);
                    
                    backupDataCache = {
                        family: backup.data?.familyMembers?.length || 0,
                        events: backup.data?.events?.length || 0,
                        suggestions: backup.data?.suggestions?.length || 0,
                        library: backup.data?.library?.length || 0,
                        date: backup.timestamp
                    };
                    
                    document.getElementById('backupFamilyCount').textContent = backupDataCache.family;
                    document.getElementById('backupEventsCount').textContent = backupDataCache.events;
                    document.getElementById('backupSuggestionsCount').textContent = backupDataCache.suggestions;
                    document.getElementById('backupLibraryCount').textContent = backupDataCache.library;
                    document.getElementById('backupDate').textContent = new Date(backupDataCache.date).toLocaleString('ar-SA');
                } else {
                    document.getElementById('backupFamilyCount').textContent = '0';
                    document.getElementById('backupEventsCount').textContent = '0';
                    document.getElementById('backupSuggestionsCount').textContent = '0';
                    document.getElementById('backupLibraryCount').textContent = '0';
                    document.getElementById('backupDate').textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©';
                }
                
                console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', backupDataCache);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ' + error.message);
            }
        }

        function compareData() {
            const result = document.getElementById('comparisonResult');
            const content = document.getElementById('comparisonContent');
            
            let comparison = '<div class="grid grid-cols-1 md:grid-cols-4 gap-4">';
            
            const categories = [
                { key: 'family', name: 'Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©', icon: 'fas fa-users' },
                { key: 'events', name: 'Ø§Ù„Ø£Ø­Ø¯Ø§Ø«', icon: 'fas fa-calendar' },
                { key: 'suggestions', name: 'Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª', icon: 'fas fa-lightbulb' },
                { key: 'library', name: 'Ø§Ù„Ù…ÙƒØªØ¨Ø©', icon: 'fas fa-book' }
            ];
            
            categories.forEach(cat => {
                const local = localDataCache[cat.key] || 0;
                const backup = backupDataCache[cat.key] || 0;
                const diff = local - backup;
                
                let statusClass = 'bg-green-50 border-green-200';
                let statusIcon = 'fas fa-check text-green-600';
                let statusText = 'Ù…ØªØ·Ø§Ø¨Ù‚';
                
                if (diff !== 0) {
                    statusClass = 'bg-yellow-50 border-yellow-200';
                    statusIcon = 'fas fa-exclamation-triangle text-yellow-600';
                    statusText = `ÙØ±Ù‚: ${diff > 0 ? '+' : ''}${diff}`;
                }
                
                comparison += `
                    <div class="card p-4 ${statusClass}">
                        <div class="text-center">
                            <i class="${cat.icon} text-2xl text-gray-700 mb-2"></i>
                            <h5 class="font-bold text-gray-800">${cat.name}</h5>
                            <div class="mt-2 space-y-1">
                                <div class="text-sm">Ù…Ø­Ù„ÙŠ: <span class="font-bold">${local}</span></div>
                                <div class="text-sm">Ø§Ø­ØªÙŠØ§Ø·ÙŠ: <span class="font-bold">${backup}</span></div>
                                <div class="flex items-center justify-center mt-2">
                                    <i class="${statusIcon} mr-1"></i>
                                    <span class="text-xs font-medium">${statusText}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            comparison += '</div>';
            content.innerHTML = comparison;
            result.classList.remove('hidden');
        }

        function createTestBackup() {
            try {
                const testData = {
                    data: JSON.parse(localStorage.getItem('al_saedan_family_data_v2') || '{"familyMembers":[],"events":[],"suggestions":[],"library":[]}'),
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    source: 'manual_backup_test'
                };
                
                localStorage.setItem('family_data_backup', JSON.stringify(testData));
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙŠØ¯ÙˆÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
                loadBackupData();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ' + error.message);
            }
        }

        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©!')) {
                localStorage.removeItem('al_saedan_family_data_v2');
                localStorage.removeItem('family_data_backup');
                sessionStorage.clear();
                
                alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                loadLocalData();
                loadBackupData();
            }
        }

        function exportBackup() {
            try {
                const backupStr = localStorage.getItem('family_data_backup');
                if (!backupStr) {
                    alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }
                
                const dataBlob = new Blob([backupStr], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `family_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + error.message);
            }
        }

        function openMainApp() {
            window.open('/index.html', '_blank');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadLocalData();
            loadBackupData();
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                loadLocalData();
                loadBackupData();
            }, 30000);
        });
    </script>
</body>
</html>