<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø¢Ù„ Ø³Ø¹ÙŠØ¯Ø§Ù† - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©</title>
    
    <!-- CSS Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet" />
    
    <!-- Arabic Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Chart.js for Statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Tailwind RTL Configuration -->
    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    'arabic': ['Noto Sans Arabic', 'Arial', 'sans-serif'],
                }
            }
        }
    </script>

    <style>
        body { 
            font-family: 'Noto Sans Arabic', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        .card:hover {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .modal {
            backdrop-filter: blur(5px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #059669);
            transform: translateY(-1px);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success { background: linear-gradient(135deg, #10b981, #059669); }
        .toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .toast.info { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-800 ml-4">
                        <i class="fas fa-sitemap text-blue-600 ml-2"></i>
                        ØªØ·Ø¨ÙŠÙ‚ Ø¢Ù„ Ø³Ø¹ÙŠØ¯Ø§Ù† Ø§Ù„Ù…Ø­Ø³Ù†
                    </h1>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-8 rtl:space-x-reverse">
                    <button id="nav-home" class="nav-item active px-4 py-2 rounded-lg transition" onclick="showSection('home')">
                        <i class="fas fa-home ml-2"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </button>
                    <button id="nav-family" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('family')">
                        <i class="fas fa-users ml-2"></i>Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
                    </button>
                    <button id="nav-events" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('events')">
                        <i class="fas fa-calendar ml-2"></i>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                    </button>
                    <button id="nav-suggestions" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('suggestions')">
                        <i class="fas fa-lightbulb ml-2"></i>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
                    </button>
                    <button id="nav-library" class="nav-item px-4 py-2 rounded-lg transition" onclick="showSection('library')">
                        <i class="fas fa-book ml-2"></i>Ø§Ù„Ù…ÙƒØªØ¨Ø©
                    </button>
                </div>
                
                <!-- Mobile menu button -->
                <button class="md:hidden" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-xl text-gray-600"></i>
                </button>
            </div>
            
            <!-- Mobile Navigation -->
            <div id="mobileMenu" class="md:hidden hidden pb-4">
                <button class="nav-item block w-full text-right px-4 py-2 rounded-lg mb-2" onclick="showSection('home')">
                    <i class="fas fa-home ml-2"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
                <button class="nav-item block w-full text-right px-4 py-2 rounded-lg mb-2" onclick="showSection('family')">
                    <i class="fas fa-users ml-2"></i>Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
                </button>
                <button class="nav-item block w-full text-right px-4 py-2 rounded-lg mb-2" onclick="showSection('events')">
                    <i class="fas fa-calendar ml-2"></i>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                </button>
                <button class="nav-item block w-full text-right px-4 py-2 rounded-lg mb-2" onclick="showSection('suggestions')">
                    <i class="fas fa-lightbulb ml-2"></i>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
                </button>
                <button class="nav-item block w-full text-right px-4 py-2 rounded-lg" onclick="showSection('library')">
                    <i class="fas fa-book ml-2"></i>Ø§Ù„Ù…ÙƒØªØ¨Ø©
                </button>
            </div>
        </div>
    </nav>

    <!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
    <div class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-2">
            <div id="syncStatus" class="text-center min-h-6"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Home Section -->
        <section id="home-section" class="section active">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Statistics Cards -->
                <div class="card p-6 text-center">
                    <div class="text-3xl text-blue-600 mb-2">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="total-members">0</h3>
                    <p class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                </div>
                <div class="card p-6 text-center">
                    <div class="text-3xl text-green-600 mb-2">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="total-events">0</h3>
                    <p class="text-gray-600">Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</p>
                </div>
                <div class="card p-6 text-center">
                    <div class="text-3xl text-yellow-600 mb-2">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="total-suggestions">0</h3>
                    <p class="text-gray-600">Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</p>
                </div>
                <div class="card p-6 text-center">
                    <div class="text-3xl text-purple-600 mb-2">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="total-library">0</h3>
                    <p class="text-gray-600">Ø§Ù„Ù…ÙƒØªØ¨Ø©</p>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</h3>
                    <canvas id="membershipChart"></canvas>
                </div>
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4">Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Events Section -->
        <section id="events-section" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h2>
                <button onclick="showAddEventForm()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition flex items-center">
                    <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
            
            <!-- Filters -->
            <div class="card p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <select id="eventStatusFilter" onchange="filterEvents()" class="px-4 py-2 border rounded-lg">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="upcoming">Ù‚Ø§Ø¯Ù…Ø©</option>
                        <option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option>
                        <option value="cancelled">Ù…Ù„ØºÙŠØ©</option>
                    </select>
                    <select id="eventTypeFilter" onchange="filterEvents()" class="px-4 py-2 border rounded-lg">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="meeting">Ø§Ø¬ØªÙ…Ø§Ø¹</option>
                        <option value="celebration">Ø§Ø­ØªÙØ§Ù„</option>
                        <option value="workshop">ÙˆØ±Ø´Ø© Ø¹Ù…Ù„</option>
                        <option value="conference">Ù…Ø¤ØªÙ…Ø±</option>
                    </select>
                    <input type="text" id="eventSearchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«..." class="px-4 py-2 border rounded-lg flex-1" oninput="filterEvents()">
                </div>
            </div>

            <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Events will be populated here -->
            </div>
        </section>

        <!-- Suggestions Section -->
        <section id="suggestions-section" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h2>
                <button onclick="showAddSuggestionForm()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition flex items-center">
                    <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
            
            <!-- Filters -->
            <div class="card p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <select id="suggestionStatusFilter" onchange="filterSuggestions()" class="px-4 py-2 border rounded-lg">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                        <option value="approved">Ù…Ù‚Ø¨ÙˆÙ„</option>
                        <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
                    </select>
                    <select id="suggestionCategoryFilter" onchange="filterSuggestions()" class="px-4 py-2 border rounded-lg">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                        <option value="improvement">ØªØ­Ø³ÙŠÙ†</option>
                        <option value="event">Ø­Ø¯Ø«</option>
                        <option value="feature">Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
                        <option value="other">Ø£Ø®Ø±Ù‰</option>
                    </select>
                    <input type="text" id="suggestionSearchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª..." class="px-4 py-2 border rounded-lg flex-1" oninput="filterSuggestions()">
                </div>
            </div>

            <div id="suggestions-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Suggestions will be populated here -->
            </div>
        </section>

        <!-- Library Section -->
        <section id="library-section" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø©</h2>
                <button onclick="showAddLibraryForm()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition flex items-center">
                    <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
            
            <!-- Filters -->
            <div class="card p-4 mb-6">
                <div class="flex flex-wrap gap-4 items-center">
                    <select id="libraryCategoryFilter" onchange="filterLibrary()" class="px-4 py-2 border rounded-lg">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                        <option value="document">ÙˆØ«ÙŠÙ‚Ø©</option>
                        <option value="image">ØµÙˆØ±Ø©</option>
                        <option value="video">ÙÙŠØ¯ÙŠÙˆ</option>
                        <option value="audio">ØµÙˆØª</option>
                        <option value="archive">Ø£Ø±Ø´ÙŠÙ</option>
                    </select>
                    <select id="libraryTypeFilter" onchange="filterLibrary()" class="px-4 py-2 border rounded-lg">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="history">ØªØ§Ø±ÙŠØ®</option>
                        <option value="genealogy">Ù†Ø³Ø¨</option>
                        <option value="photos">ØµÙˆØ±</option>
                        <option value="documents">ÙˆØ«Ø§Ø¦Ù‚</option>
                    </select>
                    <input type="text" id="librarySearchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©..." class="px-4 py-2 border rounded-lg flex-1" oninput="filterLibrary()">
                </div>
            </div>

            <div id="library-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Library items will be populated here -->
            </div>
        </section>

        <!-- Family Tree Section (keeping original functionality) -->
        <section id="family-section" class="section">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-white">Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h2>
                    <div id="syncStatus" class="text-sm text-gray-300"></div>
                </div>
                <div class="flex gap-4">
                    <button id="editModeBtn" onclick="toggleEditMode()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center">
                        <i class="fas fa-edit ml-2"></i>ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±
                    </button>
                    <button onclick="showAddMemberForm()" class="btn-primary text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                        <i class="fas fa-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
                    </button>
                </div>
            </div>
            
            <div id="family-tree" class="space-y-6">
                <!-- Family tree will be populated here -->
            </div>
        </section>
    </div>

    <!-- Modals will be inserted here by JavaScript -->
    
    <script>
        // Global variables
        let app;
        let currentSection = 'home';
        let isEditMode = false;

        // Ø­Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… JSONBin.io Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
        class SimpleSyncManager {
            constructor() {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… JSONBin.io ÙƒÙ‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© Ù…Ø¬Ø§Ù†ÙŠØ©
                this.binId = '676eb912e41b4d34e46bfb3e'; // bin Ù…Ø®ØµØµ Ù„Ø¹Ø§Ø¦Ù„Ø© Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†  
                this.apiKey = '$2a$10$Pm8ov.YjBQBEVoBEgLWvceXsKxE5kUphf7cNk3NkNgCvjJ7FJA2L.'; // Ù…ÙØªØ§Ø­ ØµØ§Ù„Ø­
                this.baseUrl = 'https://api.jsonbin.io/v3/b';
                
                this.lastSyncTime = localStorage.getItem('lastSyncTime');
                this.syncInterval = null;
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                this.startAutoSync();
            }
            
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            async loadFromServer() {
                try {
                    const response = await fetch(`${this.baseUrl}/${this.binId}/latest`, {
                        headers: {
                            'X-Master-Key': this.apiKey
                        }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('âœ… Data loaded from central server:', result.record.familyMembers?.length || 0, 'members');
                        return result.record;
                    }
                    
                    return null;
                } catch (error) {
                    console.error('âŒ Server load error:', error);
                    return null;
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
            async saveToServer(data) {
                try {
                    const response = await fetch(`${this.baseUrl}/${this.binId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': this.apiKey
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        localStorage.setItem('lastSyncTime', new Date().toISOString());
                        console.log('âœ… Data saved to central server successfully');
                        return { success: true, result };
                    }
                    
                    return { success: false, error: 'Save failed' };
                } catch (error) {
                    console.error('âŒ Server save error:', error);
                    return { success: false, error };
                }
            }
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ÙˆØ§Ù„Ø®Ø§Ø¯Ù…
            async syncData(localData) {
                try {
                    const serverData = await this.loadFromServer();
                    
                    if (serverData) {
                        const serverVersion = serverData.version || 0;
                        const localVersion = localData.version || 0;
                        
                        if (serverVersion > localVersion) {
                            console.log('ğŸ”„ Server data is newer, updating local data');
                            return { action: 'update_local', data: serverData };
                        } else if (localVersion > serverVersion) {
                            console.log('ğŸ“¤ Local data is newer, uploading to server');
                            const result = await this.saveToServer(localData);
                            return { action: 'uploaded', success: result.success };
                        } else {
                            console.log('âœ… Data is synchronized');
                            return { action: 'synced' };
                        }
                    } else {
                        console.log('ğŸ“¤ No server data, uploading local data');
                        const result = await this.saveToServer(localData);
                        return { action: 'first_upload', success: result.success };
                    }
                } catch (error) {
                    console.error('âŒ Sync error:', error);
                    return { action: 'error', error };
                }
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            startAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                }
                
                this.syncInterval = setInterval(() => {
                    if (navigator.onLine && window.app && window.app.dataManager) {
                        console.log('â° Auto sync triggered (demo mode)');
                        this.performSync();
                    }
                }, 10000); // ÙƒÙ„ 10 Ø«ÙˆØ§Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶
            }
            
            // ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©
            async performSync() {
                if (window.app && window.app.dataManager) {
                    const localData = window.app.dataManager.data;
                    const syncResult = await this.syncData(localData);
                    
                    if (syncResult.action === 'update_local') {
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                        window.app.dataManager.data = syncResult.data;
                        window.app.dataManager.saveData();
                        
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                        window.app.displayFamilyMembers();
                        window.app.initializeCharts();
                        
                        // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«
                        window.app.showToast('ğŸ”„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ø¹Ø¶Ùˆ Ø¢Ø®Ø± - ØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                        
                        // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ²Ø§Ù…Ù†
                        window.app.showSyncStatus('Ù…ØªØ²Ø§Ù…Ù†', 'success');
                    } else if (syncResult.action === 'uploaded') {
                        window.app.showSyncStatus('ØªÙ… Ø§Ù„Ø±ÙØ¹', 'success');
                    }
                }
            }
            
            stopAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
            }
        }

        // Enhanced Data Manager with Real-Time Sync
        class EnhancedDataManager {
            constructor() {
                this.storageKey = 'saedan_family_data_enhanced';
                this.data = this.loadData();
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯
                this.syncManager = new SimpleSyncManager();
                
                this.initializeDefaultData();
                
                // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
                this.performInitialSync();
            }
            
            async performInitialSync() {
                try {
                    if (navigator.onLine) {
                        const syncResult = await this.syncManager.syncData(this.data);
                        
                        if (syncResult.action === 'update_local') {
                            console.log('ğŸ”„ Initial sync: updating local data');
                            this.data = syncResult.data;
                            this.saveData();
                            
                            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                            setTimeout(() => {
                                if (window.app) {
                                    window.app.displayFamilyMembers();
                                    window.app.initializeCharts();
                                }
                            }, 1000);
                        }
                    }
                } catch (error) {
                    console.error('Initial sync failed:', error);
                }
            }

            loadData() {
                const stored = localStorage.getItem(this.storageKey);
                return stored ? JSON.parse(stored) : {};
            }

            saveData() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
            }

            initializeDefaultData() {
                // Only initialize if completely empty - preserve user-added data
                console.log('Checking existing data...', this.data);
                
                const defaultData = {
                    familyMembers: [
                        // Ø§Ù„Ù…Ø¤Ø³Ø³ - Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„
                        {
                            id: 'founder_muhammad',
                            full_name: 'Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: null,
                            generation: 1,
                            membership_type: 'founder',
                            birth_date: '1920-01-01',
                            location: 'Ù†Ø¬Ø¯',
                            phone: '',
                            email: '',
                            notes: 'Ù…Ø¤Ø³Ø³ Ø¹Ø§Ø¦Ù„Ø© Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            created_at: new Date().toISOString()
                        },
                        
                        // Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø£Ø¨Ù†Ø§Ø¡ ÙˆØ¨Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ Ù…Ø­Ù…Ø¯
                        {
                            id: 'abdullah_muhammad',
                            full_name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'chairman',
                            birth_date: '1950-01-01',
                            location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'munira_muhammad',
                            full_name: 'Ù…Ù†ÙŠØ±Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'board_member',
                            birth_date: '1952-01-01',
                            location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                            phone: '',
                            email: '',
                            gender: 'female',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'fahd_muhammad',
                            full_name: 'ÙÙ‡Ø¯ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'board_member',
                            birth_date: '1954-01-01',
                            location: 'Ø§Ù„Ø¯Ù…Ø§Ù…',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'hamd_muhammad',
                            full_name: 'Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'board_member',
                            birth_date: '1956-01-01',
                            location: 'Ø¬Ø¯Ø©',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'ibrahim_muhammad',
                            full_name: 'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'assembly_member',
                            birth_date: '1958-01-01',
                            location: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'sarah_muhammad',
                            full_name: 'Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1960-01-01',
                            location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                            phone: '',
                            email: '',
                            gender: 'female',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'abdulrahman_muhammad',
                            full_name: 'Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'assembly_member',
                            birth_date: '1962-01-01',
                            location: 'Ø§Ù„Ø£Ø­Ø³Ø§Ø¡',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'nasser_muhammad',
                            full_name: 'Ù†Ø§ØµØ± Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'assembly_member',
                            birth_date: '1964-01-01',
                            location: 'Ø§Ù„Ø·Ø§Ø¦Ù',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'saad_muhammad',
                            full_name: 'Ø³Ø¹Ø¯ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1966-01-01',
                            location: 'Ø¨Ø±ÙŠØ¯Ø©',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'nora_muhammad',
                            full_name: 'Ù†ÙˆØ±Ø© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1968-01-01',
                            location: 'Ø§Ù„Ø®Ø¨Ø±',
                            phone: '',
                            email: '',
                            gender: 'female',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'abdulmohsen_muhammad',
                            full_name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø­Ø³Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1970-01-01',
                            location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'abdulaziz_muhammad',
                            full_name: 'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1972-01-01',
                            location: 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'alanoud_muhammad',
                            full_name: 'Ø§Ù„Ø¹Ù†ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1974-01-01',
                            location: 'Ø§Ù„Ø¯Ù…Ø§Ù…',
                            phone: '',
                            email: '',
                            gender: 'female',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'mutaib_muhammad',
                            full_name: 'Ù…ØªØ¹Ø¨ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1976-01-01',
                            location: 'Ø§Ù„Ù‚ØµÙŠÙ…',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'wasmiah_muhammad',
                            full_name: 'ÙˆØ³Ù…ÙŠØ© Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1978-01-01',
                            location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                            phone: '',
                            email: '',
                            gender: 'female',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'bandar_muhammad',
                            full_name: 'Ø¨Ù†Ø¯Ø± Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'founder_muhammad',
                            generation: 2,
                            membership_type: 'family_member',
                            birth_date: '1980-01-01',
                            location: 'Ø¬Ø¯Ø©',
                            phone: '',
                            email: '',
                            gender: 'male',
                            created_at: new Date().toISOString()
                        },
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ù…Ø§Ù† Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù† (Ù…Ø·ÙˆØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚) ÙƒØ¹Ø¶Ùˆ ÙÙŠ Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ø«Ø§Ù„Ø«
                        {
                            id: 'salman_saedan',
                            full_name: 'Ø³Ù„Ù…Ø§Ù† Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            father_id: 'abdullah_muhammad', // Ø§Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡
                            generation: 3,
                            membership_type: 'board_member',
                            birth_date: '1985-01-01',
                            location: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                            phone: '0533361154',
                            email: 'info@salmansaedan.com',
                            notes: 'Ù…Ø·ÙˆØ± ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©',
                            created_at: new Date().toISOString()
                        }
                    ],
                    events: [
                        {
                            id: '1',
                            title: 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø³Ù†ÙˆÙŠ Ù„Ù„Ø¹Ø§Ø¦Ù„Ø©',
                            description: 'Ø§Ø¬ØªÙ…Ø§Ø¹ Ø³Ù†ÙˆÙŠ Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ÙˆØ§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©',
                            date: '2024-12-15',
                            time: '19:00',
                            location: 'Ù‚Ø§Ø¹Ø© Ø§Ù„Ø£ÙØ±Ø§Ø­ Ø§Ù„ÙƒØ¨Ø±Ù‰',
                            type: 'Ø§Ø¬ØªÙ…Ø§Ø¹',
                            status: 'upcoming',
                            attendees: 25,
                            created_by: 'Ø³Ù„Ù…Ø§Ù† Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            created_at: new Date().toISOString()
                        }
                    ],
                    suggestions: [
                        {
                            id: '1',
                            title: 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¹Ø§Ø¦Ù„Ø©',
                            description: 'Ø§Ù‚ØªØ±Ø§Ø­ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¨ÙŠÙ† Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©',
                            category: 'ØªØ­Ø³ÙŠÙ†',
                            status: 'approved',
                            submitted_by: 'Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            upvotes: 15,
                            downvotes: 2,
                            comments: 8,
                            created_at: new Date().toISOString()
                        }
                    ],
                    library: [
                        {
                            id: '1',
                            title: 'ØªØ§Ø±ÙŠØ® Ø¹Ø§Ø¦Ù„Ø© Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            description: 'ÙˆØ«ÙŠÙ‚Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® ÙˆØ£ØµÙˆÙ„ Ø¹Ø§Ø¦Ù„Ø© Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            category: 'ÙˆØ«ÙŠÙ‚Ø©',
                            type: 'ØªØ§Ø±ÙŠØ®',
                            author: 'Ø¯. Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†',
                            file_url: '#',
                            tags: ['ØªØ§Ø±ÙŠØ®', 'Ù†Ø³Ø¨', 'Ø¹Ø§Ø¦Ù„Ø©'],
                            created_at: new Date().toISOString()
                        }
                    ]
                };

                // Only merge if data doesn't exist at all
                Object.keys(defaultData).forEach(key => {
                    if (!this.data[key]) {
                        this.data[key] = defaultData[key];
                        console.log(`Initialized ${key} with default data`);
                    } else {
                        console.log(`Preserving existing ${key} data (${this.data[key].length} items)`);
                    }
                });

                this.saveData();
            }

            getData(category) {
                return this.data[category] || [];
            }

            addItem(category, item) {
                if (!this.data[category]) {
                    this.data[category] = [];
                }
                
                const newItem = {
                    ...item,
                    id: this.generateId(),
                    created_at: new Date().toISOString()
                };
                
                this.data[category].push(newItem);
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«
                this.data.lastUpdated = new Date().toISOString();
                this.data.version = (this.data.version || 0) + 1;
                
                this.saveData();
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ GitHub
                this.attemptSync(category, 'add', newItem);
                
                return newItem;
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© (Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±)
            attemptSync(category, action, item) {
                if (this.syncManager && navigator.onLine) {
                    // Ù…Ø²Ø§Ù…Ù†Ø© ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¨Ø·Ø¡
                    setTimeout(async () => {
                        try {
                            console.log(`ğŸ”„ Attempting sync: ${action} ${category}`);
                            
                            // Ù„Ù„Ø¢Ù† Ø³Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ
                            // ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© GitHub API Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                            
                            // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                            this.showSyncStatus('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ - Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
                            
                        } catch (error) {
                            console.error('Sync attempt failed:', error);
                        }
                    }, 100);
                }
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ©
            showSyncStatus(message, type = 'info') {
                const statusEl = document.getElementById('syncStatus');
                if (statusEl) {
                    statusEl.textContent = message;
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø©
                    let colorClass = 'text-blue-600';
                    let icon = 'ğŸ”„';
                    
                    switch (type) {
                        case 'success':
                            colorClass = 'text-green-600';
                            icon = 'âœ…';
                            break;
                        case 'error':
                            colorClass = 'text-red-600';
                            icon = 'âŒ';
                            break;
                        case 'warning':
                            colorClass = 'text-yellow-600';
                            icon = 'âš ï¸';
                            break;
                        default:
                            colorClass = 'text-blue-600';
                            icon = 'ğŸ”„';
                    }
                    
                    statusEl.className = `text-sm ${colorClass} mb-2 font-medium`;
                    statusEl.innerHTML = `${icon} ${message}`;
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù† (Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆÙ‚Øª Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£ÙØ¶Ù„)
                    setTimeout(() => {
                        statusEl.innerHTML = '';
                    }, 5000);
                }
            }

            updateItem(category, id, updates) {
                const items = this.data[category];
                const index = items.findIndex(item => item.id === id);
                
                if (index !== -1) {
                    items[index] = { 
                        ...items[index], 
                        ...updates,
                        updated_at: new Date().toISOString()
                    };
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«
                    this.data.lastUpdated = new Date().toISOString();
                    this.data.version = (this.data.version || 0) + 1;
                    
                    this.saveData();
                    
                    // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
                    this.syncToServer(category, 'update', items[index]);
                    
                    return items[index];
                }
                return null;
            }

            deleteItem(category, id) {
                const items = this.data[category];
                const index = items.findIndex(item => item.id === id);
                
                if (index !== -1) {
                    const deleted = items.splice(index, 1)[0];
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«
                    this.data.lastUpdated = new Date().toISOString();
                    this.data.version = (this.data.version || 0) + 1;
                    
                    this.saveData();
                    
                    // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø°Ù
                    this.syncToServer(category, 'delete', deleted);
                    
                    return deleted;
                }
                return null;
            }

            getItem(category, id) {
                return this.data[category]?.find(item => item.id === id) || null;
            }

            generateId() {
                return Date.now().toString() + Math.random().toString(36).substr(2, 9);
            }

            searchItems(category, searchTerm, filters = {}) {
                let items = this.getData(category);
                
                // Apply text search
                if (searchTerm) {
                    items = items.filter(item => 
                        Object.values(item).some(value => 
                            value && value.toString().toLowerCase().includes(searchTerm.toLowerCase())
                        )
                    );
                }

                // Apply filters
                Object.keys(filters).forEach(key => {
                    if (filters[key]) {
                        items = items.filter(item => item[key] === filters[key]);
                    }
                });

                return items;
            }
        }

        // Enhanced App Class
        class EnhancedAlSaedanApp {
            constructor() {
                this.dataManager = new EnhancedDataManager();
                this.charts = {};
                this.init();
            }

            init() {
                this.createModals();
                this.displayHomeStatistics();
                this.displayFamilyTree();
                this.displayEvents();
                this.displaySuggestions();
                this.displayLibrary();
                this.initializeCharts();
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø³Ù† Ø¨Ù†Ø¬Ø§Ø­');
            }

            // Utility methods
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => document.body.removeChild(toast), 300);
                }, 3000);
            }

            getStatusColor(status) {
                const colors = {
                    'pending': 'bg-yellow-100 text-yellow-700',
                    'approved': 'bg-green-100 text-green-700',
                    'rejected': 'bg-red-100 text-red-700',
                    'upcoming': 'bg-blue-100 text-blue-700',
                    'completed': 'bg-gray-100 text-gray-700',
                    'cancelled': 'bg-red-100 text-red-700'
                };
                return colors[status] || 'bg-gray-100 text-gray-700';
            }

            getStatusText(status) {
                const texts = {
                    'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                    'approved': 'Ù…Ù‚Ø¨ÙˆÙ„',
                    'rejected': 'Ù…Ø±ÙÙˆØ¶',
                    'upcoming': 'Ù‚Ø§Ø¯Ù…',
                    'completed': 'Ù…ÙƒØªÙ…Ù„',
                    'cancelled': 'Ù…Ù„ØºÙŠ'
                };
                return texts[status] || status;
            }

            getFileIcon(type) {
                const icons = {
                    'document': 'fas fa-file-alt',
                    'image': 'fas fa-image',
                    'video': 'fas fa-video',
                    'audio': 'fas fa-music',
                    'archive': 'fas fa-archive',
                    'pdf': 'fas fa-file-pdf',
                    'word': 'fas fa-file-word',
                    'excel': 'fas fa-file-excel'
                };
                return icons[type] || 'fas fa-file';
            }

            // Display methods
            displayHomeStatistics() {
                const stats = {
                    members: this.dataManager.getData('familyMembers').length,
                    events: this.dataManager.getData('events').length,
                    suggestions: this.dataManager.getData('suggestions').length,
                    library: this.dataManager.getData('library').length
                };

                document.getElementById('total-members').textContent = stats.members;
                document.getElementById('total-events').textContent = stats.events;
                document.getElementById('total-suggestions').textContent = stats.suggestions;
                document.getElementById('total-library').textContent = stats.library;
            }

            displayEvents() {
                const events = this.dataManager.getData('events');
                const container = document.getElementById('events-grid');
                if (!container) return;

                container.innerHTML = events.map(event => `
                    <div class="card p-6 relative group">
                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <button onclick="editEvent('${event.id}')" class="bg-blue-500 text-white p-2 rounded-full text-xs mr-2 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEvent('${event.id}')" class="bg-red-500 text-white p-2 rounded-full text-xs hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-semibold text-gray-800">${event.title}</h3>
                            <span class="px-2 py-1 text-xs rounded-full ${this.getStatusColor(event.status)}">
                                ${this.getStatusText(event.status)}
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">${event.description}</p>
                        <div class="space-y-2 text-sm text-gray-500">
                            <div><i class="fas fa-calendar ml-2"></i>${event.date}</div>
                            <div><i class="fas fa-clock ml-2"></i>${event.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><i class="fas fa-map-marker-alt ml-2"></i>${event.location}</div>
                            <div><i class="fas fa-tag ml-2"></i>${event.type}</div>
                            <div><i class="fas fa-users ml-2"></i>${event.attendees || 0} Ù…Ø´Ø§Ø±Ùƒ</div>
                        </div>
                    </div>
                `).join('');
            }

            displaySuggestions() {
                const suggestions = this.dataManager.getData('suggestions');
                const container = document.getElementById('suggestions-grid');
                if (!container) return;

                container.innerHTML = suggestions.map(suggestion => `
                    <div class="card p-6 relative group">
                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <button onclick="editSuggestion('${suggestion.id}')" class="bg-blue-500 text-white p-2 rounded-full text-xs mr-2 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteSuggestion('${suggestion.id}')" class="bg-red-500 text-white p-2 rounded-full text-xs hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-semibold text-gray-800">${suggestion.title}</h3>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="px-2 py-1 text-xs rounded-full ${this.getStatusColor(suggestion.status)}">
                                    ${this.getStatusText(suggestion.status)}
                                </span>
                                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full">
                                    ${suggestion.category}
                                </span>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">${suggestion.description}</p>
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                                <button onclick="voteSuggestion('${suggestion.id}', 'up')" class="flex items-center text-green-600 hover:text-green-700 transition">
                                    <i class="fas fa-thumbs-up ml-1"></i>
                                    <span>${suggestion.upvotes || 0}</span>
                                </button>
                                <button onclick="voteSuggestion('${suggestion.id}', 'down')" class="flex items-center text-red-600 hover:text-red-700 transition">
                                    <i class="fas fa-thumbs-down ml-1"></i>
                                    <span>${suggestion.downvotes || 0}</span>
                                </button>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-comments ml-2"></i>${suggestion.comments || 0} ØªØ¹Ù„ÙŠÙ‚
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            <div><i class="fas fa-user ml-2"></i>${suggestion.submitted_by}</div>
                            <div><i class="fas fa-calendar ml-2"></i>${new Date(suggestion.created_at).toLocaleDateString('ar-SA')}</div>
                        </div>
                    </div>
                `).join('');
            }

            displayLibrary() {
                const library = this.dataManager.getData('library');
                const container = document.getElementById('library-grid');
                if (!container) return;

                container.innerHTML = library.map(item => `
                    <div class="card p-6 relative group">
                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <button onclick="editLibraryItem('${item.id}')" class="bg-blue-500 text-white p-2 rounded-full text-xs mr-2 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteLibraryItem('${item.id}')" class="bg-red-500 text-white p-2 rounded-full text-xs hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="mb-3">
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded-full">${item.category}</span>
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full mr-2">${item.type}</span>
                        </div>
                        <div class="flex items-start mb-3">
                            <div class="text-4xl text-gray-400 mr-4">
                                <i class="${this.getFileIcon(item.category)}"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">${item.title}</h3>
                                <p class="text-gray-600 mb-2">${item.description}</p>
                                ${item.file_url && item.file_url !== '#' ? `<a href="${item.file_url}" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm"><i class="fas fa-download ml-1"></i>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</a>` : ''}
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <div><i class="fas fa-user ml-2"></i>${item.author}</div>
                            <div><i class="fas fa-calendar ml-2"></i>${new Date(item.created_at).toLocaleDateString('ar-SA')}</div>
                        </div>
                        ${item.tags ? `<div class="mt-3"><span class="text-xs text-gray-500">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª: ${item.tags.join(', ')}</span></div>` : ''}
                    </div>
                `).join('');
            }

            displayFamilyTree() {
                const familyMembers = this.dataManager.getData('familyMembers');
                const container = document.getElementById('family-tree');
                if (!container) return;

                // Group by generation
                const generations = {};
                familyMembers.forEach(member => {
                    const gen = member.generation || 1;
                    if (!generations[gen]) generations[gen] = [];
                    generations[gen].push(member);
                });

                container.innerHTML = Object.keys(generations)
                    .sort((a, b) => a - b)
                    .map(gen => `
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                                <i class="fas fa-layer-group ml-2"></i>
                                Ø§Ù„Ø¬ÙŠÙ„ ${gen}
                                <span class="text-sm bg-white text-blue-600 px-2 py-1 rounded-full mr-3">
                                    ${generations[gen].length} Ø¹Ø¶Ùˆ
                                </span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${generations[gen].map(member => `
                                    <div class="card p-6 member-card relative">
                                        <div class="member-actions">
                                            <button onclick="editFamilyMember('${member.id}')" class="edit-btn">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="deleteFamilyMember('${member.id}')" class="delete-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div class="flex items-center mb-4">
                                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xl font-bold mr-4">
                                                ${member.full_name.charAt(0)}
                                            </div>
                                            <div>
                                                <h4 class="text-lg font-semibold text-gray-800">${member.full_name}</h4>
                                                <span class="px-2 py-1 text-xs rounded-full ${this.getMembershipTypeColor(member.membership_type)}">
                                                    ${this.getMembershipTypeText(member.membership_type)}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="space-y-2 text-sm text-gray-600">
                                            ${member.birth_date ? `<div><i class="fas fa-birthday-cake ml-2"></i>${member.birth_date}</div>` : ''}
                                            ${member.location ? `<div><i class="fas fa-map-marker-alt ml-2"></i>${member.location}</div>` : ''}
                                            ${member.phone ? `<div><i class="fas fa-phone ml-2"></i>${member.phone}</div>` : ''}
                                            ${member.email ? `<div><i class="fas fa-envelope ml-2"></i>${member.email}</div>` : ''}
                                            ${member.father_id ? `<div><i class="fas fa-male ml-2"></i>ÙˆØ§Ù„Ø¯Ù‡: ${this.getFatherName(member.father_id)}</div>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
            }

            // Helper methods for family tree
            getMembershipTypeColor(type) {
                const colors = {
                    'founder': 'bg-purple-100 text-purple-700',
                    'chairman': 'bg-red-100 text-red-700',
                    'board_member': 'bg-blue-100 text-blue-700',
                    'general_assembly': 'bg-green-100 text-green-700',
                    'family_member': 'bg-gray-100 text-gray-700',
                    'honorary': 'bg-yellow-100 text-yellow-700'
                };
                return colors[type] || 'bg-gray-100 text-gray-700';
            }

            getMembershipTypeText(type) {
                const texts = {
                    'founder': 'Ù…Ø¤Ø³Ø³',
                    'chairman': 'Ø±Ø¦ÙŠØ³ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                    'board_member': 'Ø¹Ø¶Ùˆ Ù…Ø¬Ù„Ø³ Ø¥Ø¯Ø§Ø±Ø©',
                    'general_assembly': 'Ø¹Ø¶Ùˆ Ø¬Ù…Ø¹ÙŠØ© Ø¹Ù…ÙˆÙ…ÙŠØ©',
                    'family_member': 'Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø©',
                    'honorary': 'Ø¹Ø¶Ùˆ Ø´Ø±ÙÙŠ'
                };
                return texts[type] || type;
            }

            getFatherName(fatherId) {
                const familyMembers = this.dataManager.getData('familyMembers');
                const father = familyMembers.find(m => m.id === fatherId);
                return father ? father.full_name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }

            // Chart initialization
            initializeCharts() {
                this.createMembershipChart();
                this.createActivityChart();
            }

            createMembershipChart() {
                const ctx = document.getElementById('membershipChart');
                if (!ctx) return;

                const familyMembers = this.dataManager.getData('familyMembers');
                const membershipTypes = {};
                
                familyMembers.forEach(member => {
                    const type = this.getMembershipTypeText(member.membership_type);
                    membershipTypes[type] = (membershipTypes[type] || 0) + 1;
                });

                this.charts.membership = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(membershipTypes),
                        datasets: [{
                            data: Object.values(membershipTypes),
                            backgroundColor: [
                                '#8B5CF6', '#EF4444', '#3B82F6', 
                                '#10B981', '#6B7280', '#F59E0B'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            createActivityChart() {
                const ctx = document.getElementById('activityChart');
                if (!ctx) return;

                // Mock data for monthly activities
                const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'];
                const eventData = [2, 1, 3, 2, 4, 1];
                const suggestionData = [5, 3, 7, 4, 6, 8];

                this.charts.activity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Ø§Ù„Ø£Ø­Ø¯Ø§Ø«',
                            data: eventData,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª',
                            data: suggestionData,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Create all modals
            createModals() {
                const modalsHTML = `
                    <!-- Add Event Modal -->
                    <div id="addEventModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</h3>
                                <button onclick="hideAddEventModal()" class="text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="addEventForm" onsubmit="handleAddEvent(event)">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø¯Ø«</label>
                                        <input type="text" name="title" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø«</label>
                                        <select name="type" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                                            <option value="Ø§Ø¬ØªÙ…Ø§Ø¹">Ø§Ø¬ØªÙ…Ø§Ø¹</option>
                                            <option value="Ø§Ø­ØªÙØ§Ù„">Ø§Ø­ØªÙØ§Ù„</option>
                                            <option value="ÙˆØ±Ø´Ø© Ø¹Ù…Ù„">ÙˆØ±Ø´Ø© Ø¹Ù…Ù„</option>
                                            <option value="Ù…Ø¤ØªÙ…Ø±">Ù…Ø¤ØªÙ…Ø±</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                        <input type="date" name="date" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙˆÙ‚Øª</label>
                                        <input type="time" name="time" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…ÙƒØ§Ù†</label>
                                        <input type="text" name="location" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                        <select name="status" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="upcoming">Ù‚Ø§Ø¯Ù…</option>
                                            <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                                            <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø«</label>
                                    <textarea name="description" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                                    <input type="number" name="attendees" min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="flex justify-end space-x-4 rtl:space-x-reverse mt-6">
                                    <button type="button" onclick="hideAddEventModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg">
                                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø«
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Add Suggestion Modal -->
                    <div id="addSuggestionModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯</h3>
                                <button onclick="hideAddSuggestionModal()" class="text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="addSuggestionForm" onsubmit="handleAddSuggestion(event)">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label>
                                        <input type="text" name="title" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙØ¦Ø©</label>
                                        <select name="category" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                                            <option value="ØªØ­Ø³ÙŠÙ†">ØªØ­Ø³ÙŠÙ†</option>
                                            <option value="Ø­Ø¯Ø«">Ø­Ø¯Ø«</option>
                                            <option value="Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©">Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
                                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù‚Ø¯Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label>
                                        <input type="text" name="submitted_by" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                        <select name="status" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                                            <option value="approved">Ù…Ù‚Ø¨ÙˆÙ„</option>
                                            <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label>
                                    <textarea name="description" rows="4" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                                <div class="flex justify-end space-x-4 rtl:space-x-reverse mt-6">
                                    <button type="button" onclick="hideAddSuggestionModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg">
                                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Add Library Item Modal -->
                    <div id="addLibraryModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙƒØªØ¨Ø©</h3>
                                <button onclick="hideAddLibraryModal()" class="text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="addLibraryForm" onsubmit="handleAddLibrary(event)">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                                        <input type="text" name="title" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø¤Ù„Ù</label>
                                        <input type="text" name="author" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙØ¦Ø©</label>
                                        <select name="category" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                                            <option value="ÙˆØ«ÙŠÙ‚Ø©">ÙˆØ«ÙŠÙ‚Ø©</option>
                                            <option value="ØµÙˆØ±Ø©">ØµÙˆØ±Ø©</option>
                                            <option value="ÙÙŠØ¯ÙŠÙˆ">ÙÙŠØ¯ÙŠÙˆ</option>
                                            <option value="ØµÙˆØª">ØµÙˆØª</option>
                                            <option value="Ø£Ø±Ø´ÙŠÙ">Ø£Ø±Ø´ÙŠÙ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù†ÙˆØ¹</label>
                                        <select name="type" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                                            <option value="ØªØ§Ø±ÙŠØ®">ØªØ§Ø±ÙŠØ®</option>
                                            <option value="Ù†Ø³Ø¨">Ù†Ø³Ø¨</option>
                                            <option value="ØµÙˆØ±">ØµÙˆØ±</option>
                                            <option value="ÙˆØ«Ø§Ø¦Ù‚">ÙˆØ«Ø§Ø¦Ù‚</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆØµÙ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                                    <textarea name="description" rows="4" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <input type="url" name="file_url" placeholder="https://example.com/file.pdf" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
                                    <input type="text" name="tags" placeholder="ØªØ§Ø±ÙŠØ®, Ø¹Ø§Ø¦Ù„Ø©, ÙˆØ«Ø§Ø¦Ù‚" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="flex justify-end space-x-4 rtl:space-x-reverse mt-6">
                                    <button type="button" onclick="hideAddLibraryModal()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg">
                                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Add Family Member Modal (keeping from original) -->
                    <div id="addMemberModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</h3>
                                <button onclick="hideAddMemberForm()" class="text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <form id="addMemberForm" onsubmit="handleAddMember(event)">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                        <input type="text" name="full_name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</label>
                                        <select name="membership_type" required onchange="handleMembershipTypeChange(this)" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</option>
                                            <option value="founder">Ù…Ø¤Ø³Ø³</option>
                                            <option value="chairman">Ø±Ø¦ÙŠØ³ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                                            <option value="board_member">Ø¹Ø¶Ùˆ Ù…Ø¬Ù„Ø³ Ø¥Ø¯Ø§Ø±Ø©</option>
                                            <option value="general_assembly">Ø¹Ø¶Ùˆ Ø¬Ù…Ø¹ÙŠØ© Ø¹Ù…ÙˆÙ…ÙŠØ©</option>
                                            <option value="family_member">Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø©</option>
                                            <option value="honorary">Ø¹Ø¶Ùˆ Ø´Ø±ÙÙŠ</option>
                                        </select>
                                    </div>
                                    <div id="father-field-add">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø£Ø¨</label>
                                        <select name="father_id" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¨ --</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¬ÙŠÙ„</label>
                                        <input type="number" name="generation" min="1" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                                        <input type="date" name="birth_date" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…ÙƒØ§Ù†</label>
                                        <input type="text" name="location" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                        <input type="tel" name="phone" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                        <input type="email" name="email" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                                <div class="flex justify-end space-x-4 rtl:space-x-reverse mt-6">
                                    <button type="button" onclick="hideAddMemberForm()" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                    <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg">
                                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalsHTML);
            }

            // CRUD Operations for Events
            addEvent(eventData) {
                const newEvent = this.dataManager.addItem('events', eventData);
                this.displayEvents();
                this.displayHomeStatistics();
                if (this.charts.activity) this.charts.activity.update();
                return newEvent;
            }

            updateEvent(id, updates) {
                const updated = this.dataManager.updateItem('events', id, updates);
                if (updated) {
                    this.displayEvents();
                    this.showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­');
                }
                return updated;
            }

            deleteEvent(id) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯Ø«ØŸ')) {
                    const deleted = this.dataManager.deleteItem('events', id);
                    if (deleted) {
                        this.displayEvents();
                        this.displayHomeStatistics();
                        if (this.charts.activity) this.charts.activity.update();
                        this.showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­');
                    }
                }
            }

            // CRUD Operations for Suggestions
            addSuggestion(suggestionData) {
                const newSuggestion = this.dataManager.addItem('suggestions', {
                    ...suggestionData,
                    upvotes: 0,
                    downvotes: 0,
                    comments: 0
                });
                this.displaySuggestions();
                this.displayHomeStatistics();
                return newSuggestion;
            }

            updateSuggestion(id, updates) {
                const updated = this.dataManager.updateItem('suggestions', id, updates);
                if (updated) {
                    this.displaySuggestions();
                    this.showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­');
                }
                return updated;
            }

            deleteSuggestion(id) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ØŸ')) {
                    const deleted = this.dataManager.deleteItem('suggestions', id);
                    if (deleted) {
                        this.displaySuggestions();
                        this.displayHomeStatistics();
                        this.showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­');
                    }
                }
            }

            voteSuggestion(id, type) {
                const suggestion = this.dataManager.getItem('suggestions', id);
                if (suggestion) {
                    const updates = {};
                    if (type === 'up') {
                        updates.upvotes = (suggestion.upvotes || 0) + 1;
                    } else if (type === 'down') {
                        updates.downvotes = (suggestion.downvotes || 0) + 1;
                    }
                    this.updateSuggestion(id, updates);
                }
            }

            // CRUD Operations for Library
            addLibraryItem(itemData) {
                // Process tags
                if (itemData.tags && typeof itemData.tags === 'string') {
                    itemData.tags = itemData.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                }
                
                const newItem = this.dataManager.addItem('library', itemData);
                this.displayLibrary();
                this.displayHomeStatistics();
                return newItem;
            }

            updateLibraryItem(id, updates) {
                const updated = this.dataManager.updateItem('library', id, updates);
                if (updated) {
                    this.displayLibrary();
                    this.showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­');
                }
                return updated;
            }

            deleteLibraryItem(id) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) {
                    const deleted = this.dataManager.deleteItem('library', id);
                    if (deleted) {
                        this.displayLibrary();
                        this.displayHomeStatistics();
                        this.showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­');
                    }
                }
            }

            // Family member operations (keeping original functionality)
            addFamilyMember(memberData) {
                const newMember = this.dataManager.addItem('familyMembers', memberData);
                this.displayFamilyTree();
                this.displayHomeStatistics();
                this.populateParentDropdowns();
                if (this.charts.membership) this.charts.membership.destroy();
                this.createMembershipChart();
                return newMember;
            }

            populateParentDropdowns() {
                const familyMembers = this.dataManager.getData('familyMembers');
                const fatherSelect = document.querySelector('select[name="father_id"]');
                
                if (!fatherSelect) return;
                
                fatherSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¨ --</option>';
                
                familyMembers.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = member.full_name + ' (Ø§Ù„Ø¬ÙŠÙ„ ' + member.generation + ')';
                    fatherSelect.appendChild(option);
                });
            }
            
            // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ø§Ù„Ø§Øª
            getStatusColor(status) {
                const colors = {
                    'pending': 'bg-yellow-100 text-yellow-700',
                    'approved': 'bg-green-100 text-green-700',
                    'rejected': 'bg-red-100 text-red-700',
                    'under_review': 'bg-blue-100 text-blue-700'
                };
                return colors[status] || 'bg-gray-100 text-gray-700';
            }
            
            getStatusText(status) {
                const texts = {
                    'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                    'approved': 'Ù…Ù‚Ø¨ÙˆÙ„',
                    'rejected': 'Ù…Ø±ÙÙˆØ¶',
                    'under_review': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
                };
                return texts[status] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
            
            getFileIcon(type) {
                const icons = {
                    'pdf': 'fas fa-file-pdf',
                    'doc': 'fas fa-file-word',
                    'image': 'fas fa-file-image',
                    'video': 'fas fa-file-video',
                    'audio': 'fas fa-file-audio',
                    'book': 'fas fa-book',
                    'article': 'fas fa-newspaper',
                    'research': 'fas fa-microscope'
                };
                return icons[type] || 'fas fa-file';
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
            addEvent(eventData) {
                const newEvent = this.dataManager.addItem('events', {
                    ...eventData,
                    created_at: new Date().toISOString(),
                    attendees: 0
                });
                this.displayEvents();
                return newEvent;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯
            addSuggestion(suggestionData) {
                const newSuggestion = this.dataManager.addItem('suggestions', {
                    ...suggestionData,
                    created_at: new Date().toISOString(),
                    upvotes: 0,
                    downvotes: 0,
                    comments: 0,
                    status: 'pending'
                });
                this.displaySuggestions();
                return newSuggestion;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù…ÙƒØªØ¨Ø© Ø¬Ø¯ÙŠØ¯
            addLibraryItem(itemData) {
                const newItem = this.dataManager.addItem('library', {
                    ...itemData,
                    created_at: new Date().toISOString(),
                    tags: itemData.tags ? itemData.tags.split(',').map(tag => tag.trim()) : []
                });
                this.displayLibrary();
                return newItem;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯ - Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©
            addFamilyMember(memberData) {
                console.log('Adding new family member:', memberData);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                if (!memberData.full_name) {
                    throw new Error('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨');
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¨
                if (memberData.father_id) {
                    const father = this.dataManager.getData('familyMembers')
                        .find(m => m.id === memberData.father_id);
                    if (father) {
                        memberData.generation = father.generation + 1;
                    }
                } else {
                    memberData.generation = 1; // Ø§Ù„Ù…Ø¤Ø³Ø³
                }
                
                const newMember = this.dataManager.addItem('familyMembers', {
                    ...memberData,
                    created_at: new Date().toISOString()
                });
                
                console.log('Family member added successfully:', newMember);
                console.log('Total members now:', this.dataManager.getData('familyMembers').length);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­ÙØ¸ ÙÙŠ localStorage
                const savedData = localStorage.getItem(this.dataManager.storageKey);
                console.log('Data saved to localStorage:', savedData ? 'Yes' : 'No');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                this.displayFamilyMembers();
                this.loadFatherOptions();
                this.initializeCharts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                
                return newMember;
            }
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø©
            editFamilyMember(id, memberData) {
                console.log('Editing family member:', id, memberData);
                
                const updatedMember = this.dataManager.updateItem('familyMembers', id, memberData);
                
                if (updatedMember) {
                    console.log('Family member updated successfully:', updatedMember);
                    this.displayFamilyMembers();
                    this.initializeCharts();
                }
                
                return updatedMember;
            }
            
            // Ø­Ø°Ù Ø¹Ø¶Ùˆ Ø¹Ø§Ø¦Ù„Ø©
            deleteFamilyMember(id) {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø­Ø°Ù Ø§Ù„Ù…Ø¤Ø³Ø³
                const member = this.dataManager.getData('familyMembers').find(m => m.id === id);
                if (member && member.membership_type === 'founder') {
                    alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ø¤Ø³Ø³!');
                    return false;
                }
                
                console.log('Deleting family member:', id);
                
                const deleted = this.dataManager.deleteItem('familyMembers', id);
                
                if (deleted) {
                    console.log('Family member deleted successfully');
                    this.displayFamilyMembers();
                    this.loadFatherOptions();
                    this.initializeCharts();
                }
                
                return deleted;
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            app = new EnhancedAlSaedanApp();
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø¨Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            setTimeout(() => {
                if (app.dataManager.syncManager) {
                    app.dataManager.showSyncStatus('Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù† ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø¨ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'success');
                }
            }, 2000);
            
            // Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ø¹Ù† Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                if (app.dataManager.syncManager && navigator.onLine) {
                    app.showToast('âœ¨ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª ØªÙ‚ÙˆÙ… Ø¨Ù‡Ø§ Ø³ÙŠØªÙ… Ù…Ø²Ø§Ù…Ù†ØªÙ‡Ø§ Ø§ÙÙˆØ±ÙŠØ§Ù‹ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†!');
                }
            }, 5000);
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„ØªØ·ÙˆÙŠØ±)
            const debugButton = document.createElement('button');
            debugButton.textContent = 'ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
            debugButton.className = 'fixed bottom-4 left-4 bg-red-500 text-white px-3 py-1 rounded text-sm';
            debugButton.onclick = function() {
                const data = localStorage.getItem('saedan_family_data_enhanced');
                console.log('=== ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===');
                console.log('localStorage key:', 'saedan_family_data_enhanced');
                console.log('Data exists:', !!data);
                if (data) {
                    const parsed = JSON.parse(data);
                    console.log('Family members count:', parsed.familyMembers?.length || 0);
                    console.log('All data:', parsed);
                }
                alert(`Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ${data ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}\nØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${data ? JSON.parse(data).familyMembers?.length || 0 : 0}`);
            };
            document.body.appendChild(debugButton);
        });

        // Navigation functions
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            const activeNav = document.getElementById('nav-' + sectionName);
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            currentSection = sectionName;
            document.getElementById('mobileMenu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // Modal functions
        function showAddEventModal() {
            document.getElementById('addEventModal').classList.remove('hidden');
        }

        function hideAddEventModal() {
            document.getElementById('addEventModal').classList.add('hidden');
            document.getElementById('addEventForm').reset();
        }

        function showAddSuggestionModal() {
            document.getElementById('addSuggestionModal').classList.remove('hidden');
        }

        function hideAddSuggestionModal() {
            document.getElementById('addSuggestionModal').classList.add('hidden');
            document.getElementById('addSuggestionForm').reset();
        }

        function showAddLibraryModal() {
            document.getElementById('addLibraryModal').classList.remove('hidden');
        }

        function hideAddLibraryModal() {
            document.getElementById('addLibraryModal').classList.add('hidden');
            document.getElementById('addLibraryForm').reset();
        }

        function showAddMemberForm() {
            if (app) app.populateParentDropdowns();
            const form = document.getElementById('addMemberForm');
            const fatherField = document.getElementById('father-field-add');
            const generationInput = form.querySelector('input[name="generation"]');
            
            if (fatherField) fatherField.style.display = 'block';
            if (generationInput) {
                generationInput.readOnly = false;
                generationInput.style.backgroundColor = 'white';
            }
            
            document.getElementById('addMemberModal').classList.remove('hidden');
        }

        function hideAddMemberForm() {
            document.getElementById('addMemberModal').classList.add('hidden');
            document.getElementById('addMemberForm').reset();
        }

        // Form handlers
        function handleAddEvent(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const eventData = Object.fromEntries(formData.entries());
            
            if (app) {
                app.addEvent(eventData);
                app.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­');
                hideAddEventModal();
            }
        }

        function handleAddSuggestion(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const suggestionData = Object.fromEntries(formData.entries());
            
            if (app) {
                app.addSuggestion(suggestionData);
                app.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­');
                hideAddSuggestionModal();
            }
        }

        function handleAddLibrary(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const libraryData = Object.fromEntries(formData.entries());
            
            if (app) {
                app.addLibraryItem(libraryData);
                app.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­');
                hideAddLibraryModal();
            }
        }

        function handleAddMember(event) {
            event.preventDefault();
            console.log('Form submitted for adding member');
            
            const formData = new FormData(event.target);
            const memberData = Object.fromEntries(formData.entries());
            
            console.log('Member data to be added:', memberData);
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!memberData.full_name || !memberData.membership_type) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (app) {
                try {
                    const newMember = app.addFamilyMember(memberData);
                    if (newMember) {
                        app.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
                        hideAddMemberForm();
                        
                        // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø¹Ø±Ø¶
                        setTimeout(() => {
                            if (currentSection === 'family') {
                                app.displayFamilyMembers();
                            }
                        }, 100);
                    }
                } catch (error) {
                    console.error('Error adding member:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ');
                }
            }
        }

        function handleMembershipTypeChange(selectElement) {
            const membershipType = selectElement.value;
            const form = selectElement.closest('form');
            
            const fatherField = document.getElementById('father-field-add');
            const generationInput = form.querySelector('input[name="generation"]');
            const fatherSelect = form.querySelector('select[name="father_id"]');
            
            if (membershipType === 'founder') {
                if (fatherField) fatherField.style.display = 'none';
                if (generationInput) {
                    generationInput.value = 1;
                    generationInput.readOnly = true;
                    generationInput.style.backgroundColor = '#f3f4f6';
                }
                if (fatherSelect) fatherSelect.value = '';
            } else {
                if (fatherField) fatherField.style.display = 'block';
                if (generationInput) {
                    generationInput.readOnly = false;
                    generationInput.style.backgroundColor = 'white';
                    if (generationInput.value === '1') generationInput.value = '';
                }
            }
        }

        // Edit and delete functions
        function editEvent(id) {
            if (app) {
                const event = app.dataManager.getItem('events', id);
                if (event) {
                    // Show modal with pre-filled data
                    showAddEventModal();
                    const form = document.getElementById('addEventForm');
                    Object.keys(event).forEach(key => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) input.value = event[key];
                    });
                    
                    // Change form behavior to update instead of add
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        const formData = new FormData(e.target);
                        const updates = Object.fromEntries(formData.entries());
                        app.updateEvent(id, updates);
                        hideAddEventModal();
                        form.onsubmit = handleAddEvent; // Reset to add mode
                    };
                }
            }
        }

        function deleteEvent(id) {
            if (app) app.deleteEvent(id);
        }

        function editSuggestion(id) {
            if (app) {
                const suggestion = app.dataManager.getItem('suggestions', id);
                if (suggestion) {
                    showAddSuggestionModal();
                    const form = document.getElementById('addSuggestionForm');
                    Object.keys(suggestion).forEach(key => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) input.value = suggestion[key];
                    });
                    
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        const formData = new FormData(e.target);
                        const updates = Object.fromEntries(formData.entries());
                        app.updateSuggestion(id, updates);
                        hideAddSuggestionModal();
                        form.onsubmit = handleAddSuggestion;
                    };
                }
            }
        }

        function deleteSuggestion(id) {
            if (app) app.deleteSuggestion(id);
        }

        function voteSuggestion(id, type) {
            if (app) app.voteSuggestion(id, type);
        }

        function editLibraryItem(id) {
            if (app) {
                const item = app.dataManager.getItem('library', id);
                if (item) {
                    showAddLibraryModal();
                    const form = document.getElementById('addLibraryForm');
                    Object.keys(item).forEach(key => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) {
                            if (key === 'tags' && Array.isArray(item[key])) {
                                input.value = item[key].join(', ');
                            } else {
                                input.value = item[key];
                            }
                        }
                    });
                    
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        const formData = new FormData(e.target);
                        const updates = Object.fromEntries(formData.entries());
                        app.updateLibraryItem(id, updates);
                        hideAddLibraryModal();
                        form.onsubmit = handleAddLibrary;
                    };
                }
            }
        }

        function deleteLibraryItem(id) {
            if (app) app.deleteLibraryItem(id);
        }

        // Filter functions
        function filterEvents() {
            const status = document.getElementById('eventStatusFilter').value;
            const type = document.getElementById('eventTypeFilter').value;
            const search = document.getElementById('eventSearchInput').value;
            
            if (app) {
                const filtered = app.dataManager.searchItems('events', search, {
                    status: status || undefined,
                    type: type || undefined
                });
                
                const container = document.getElementById('events-grid');
                container.innerHTML = filtered.map(event => `
                    <div class="card p-6 relative group">
                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <button onclick="editEvent('${event.id}')" class="bg-blue-500 text-white p-2 rounded-full text-xs mr-2 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEvent('${event.id}')" class="bg-red-500 text-white p-2 rounded-full text-xs hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-semibold text-gray-800">${event.title}</h3>
                            <span class="px-2 py-1 text-xs rounded-full ${app.getStatusColor(event.status)}">
                                ${app.getStatusText(event.status)}
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">${event.description}</p>
                        <div class="space-y-2 text-sm text-gray-500">
                            <div><i class="fas fa-calendar ml-2"></i>${event.date}</div>
                            <div><i class="fas fa-clock ml-2"></i>${event.time || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            <div><i class="fas fa-map-marker-alt ml-2"></i>${event.location}</div>
                            <div><i class="fas fa-tag ml-2"></i>${event.type}</div>
                            <div><i class="fas fa-users ml-2"></i>${event.attendees || 0} Ù…Ø´Ø§Ø±Ùƒ</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function filterSuggestions() {
            const status = document.getElementById('suggestionStatusFilter').value;
            const category = document.getElementById('suggestionCategoryFilter').value;
            const search = document.getElementById('suggestionSearchInput').value;
            
            if (app) {
                const filtered = app.dataManager.searchItems('suggestions', search, {
                    status: status || undefined,
                    category: category || undefined
                });
                
                const container = document.getElementById('suggestions-grid');
                container.innerHTML = filtered.map(suggestion => `
                    <div class="card p-6 relative group">
                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <button onclick="editSuggestion('${suggestion.id}')" class="bg-blue-500 text-white p-2 rounded-full text-xs mr-2 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteSuggestion('${suggestion.id}')" class="bg-red-500 text-white p-2 rounded-full text-xs hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-semibold text-gray-800">${suggestion.title}</h3>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="px-2 py-1 text-xs rounded-full ${app.getStatusColor(suggestion.status)}">
                                    ${app.getStatusText(suggestion.status)}
                                </span>
                                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full">
                                    ${suggestion.category}
                                </span>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">${suggestion.description}</p>
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                                <button onclick="voteSuggestion('${suggestion.id}', 'up')" class="flex items-center text-green-600 hover:text-green-700 transition">
                                    <i class="fas fa-thumbs-up ml-1"></i>
                                    <span>${suggestion.upvotes || 0}</span>
                                </button>
                                <button onclick="voteSuggestion('${suggestion.id}', 'down')" class="flex items-center text-red-600 hover:text-red-700 transition">
                                    <i class="fas fa-thumbs-down ml-1"></i>
                                    <span>${suggestion.downvotes || 0}</span>
                                </button>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-comments ml-2"></i>${suggestion.comments || 0} ØªØ¹Ù„ÙŠÙ‚
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            <div><i class="fas fa-user ml-2"></i>${suggestion.submitted_by}</div>
                            <div><i class="fas fa-calendar ml-2"></i>${new Date(suggestion.created_at).toLocaleDateString('ar-SA')}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function filterLibrary() {
            const category = document.getElementById('libraryCategoryFilter').value;
            const type = document.getElementById('libraryTypeFilter').value;
            const search = document.getElementById('librarySearchInput').value;
            
            if (app) {
                const filtered = app.dataManager.searchItems('library', search, {
                    category: category || undefined,
                    type: type || undefined
                });
                
                const container = document.getElementById('library-grid');
                container.innerHTML = filtered.map(item => `
                    <div class="card p-6 relative group">
                        <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                            <button onclick="editLibraryItem('${item.id}')" class="bg-blue-500 text-white p-2 rounded-full text-xs mr-2 hover:bg-blue-600">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteLibraryItem('${item.id}')" class="bg-red-500 text-white p-2 rounded-full text-xs hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="mb-3">
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded-full">${item.category}</span>
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full mr-2">${item.type}</span>
                        </div>
                        <div class="flex items-start mb-3">
                            <div class="text-4xl text-gray-400 mr-4">
                                <i class="${app.getFileIcon(item.category)}"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">${item.title}</h3>
                                <p class="text-gray-600 mb-2">${item.description}</p>
                                ${item.file_url && item.file_url !== '#' ? `<a href="${item.file_url}" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm"><i class="fas fa-download ml-1"></i>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</a>` : ''}
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <div><i class="fas fa-user ml-2"></i>${item.author}</div>
                            <div><i class="fas fa-calendar ml-2"></i>${new Date(item.created_at).toLocaleDateString('ar-SA')}</div>
                        </div>
                        ${item.tags ? `<div class="mt-3"><span class="text-xs text-gray-500">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª: ${item.tags.join(', ')}</span></div>` : ''}
                    </div>
                `).join('');
            }
        }

        // Family tree functions (keeping original)
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('editModeBtn');
            const container = document.getElementById('family-tree');
            
            if (btn) {
                if (isEditMode) {
                    btn.innerHTML = '<i class="fas fa-eye ml-2"></i>ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶';
                    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition flex items-center';
                    if (container) container.classList.add('edit-mode');
                } else {
                    btn.innerHTML = '<i class="fas fa-edit ml-2"></i>ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±';
                    btn.className = 'bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center';
                    if (container) container.classList.remove('edit-mode');
                }
            }
        }

        function editFamilyMember(id) {
            if (app) {
                const member = app.dataManager.getItem('familyMembers', id);
                if (member) {
                    showAddMemberForm();
                    const form = document.getElementById('addMemberForm');
                    Object.keys(member).forEach(key => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) input.value = member[key];
                    });
                    
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        const formData = new FormData(e.target);
                        const updates = Object.fromEntries(formData.entries());
                        const updated = app.dataManager.updateItem('familyMembers', id, updates);
                        if (updated) {
                            app.displayFamilyTree();
                            app.displayHomeStatistics();
                            app.populateParentDropdowns();
                            app.showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
                        }
                        hideAddMemberForm();
                        form.onsubmit = handleAddMember;
                    };
                }
            }
        }

        function deleteFamilyMember(id) {
            if (app && confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶ÙˆØŸ')) {
                const deleted = app.dataManager.deleteItem('familyMembers', id);
                if (deleted) {
                    app.displayFamilyTree();
                    app.displayHomeStatistics();
                    app.populateParentDropdowns();
                    if (app.charts.membership) {
                        app.charts.membership.destroy();
                        app.createMembershipChart();
                    }
                    app.showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
                }
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function showAddEventForm() {
            document.getElementById('addEventModal').classList.remove('hidden');
        }
        
        function hideAddEventForm() {
            document.getElementById('addEventModal').classList.add('hidden');
            const form = document.getElementById('addEventForm');
            if (form) {
                form.reset();
                form.removeAttribute('data-edit-id');
                document.querySelector('#addEventModal h3').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯';
            }
        }
        
        function submitEvent() {
            const form = document.getElementById('addEventForm');
            const formData = new FormData(form);
            const editId = form.getAttribute('data-edit-id');
            
            const eventData = {
                title: formData.get('title'),
                description: formData.get('description'),
                type: formData.get('type'),
                date: formData.get('date'),
                time: formData.get('time'),
                location: formData.get('location'),
                status: formData.get('status') || 'upcoming'
            };
            
            if (editId) {
                // ØªØ­Ø±ÙŠØ± Ø­Ø¯Ø« Ù…ÙˆØ¬ÙˆØ¯
                let events = JSON.parse(localStorage.getItem('events') || '[]');
                const index = events.findIndex(e => e.id === editId);
                if (index !== -1) {
                    events[index] = { ...events[index], ...eventData };
                    localStorage.setItem('events', JSON.stringify(events));
                }
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
                if (app) app.addEvent(eventData);
            }
            
            if (app) app.displayEvents();
            hideAddEventForm();
            showNotification('ØªÙ… ' + (editId ? 'ØªØ­Ø¯ÙŠØ«' : 'Ø¥Ø¶Ø§ÙØ©') + ' Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }
        
        function editEvent(eventId) {
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const form = document.getElementById('addEventForm');
            form.title.value = event.title;
            form.description.value = event.description;
            form.type.value = event.type;
            form.date.value = event.date;
            form.time.value = event.time || '';
            form.location.value = event.location;
            form.status.value = event.status;
            
            form.setAttribute('data-edit-id', eventId);
            document.getElementById('addEventModal').classList.remove('hidden');
            document.querySelector('#addEventModal h3').textContent = 'ØªØ­Ø±ÙŠØ± Ø§Ù„Ø­Ø¯Ø«';
        }
        
        function deleteEvent(eventId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯Ø«ØŸ')) {
                let events = JSON.parse(localStorage.getItem('events') || '[]');
                events = events.filter(e => e.id !== eventId);
                localStorage.setItem('events', JSON.stringify(events));
                if (app) app.displayEvents();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
        function showAddSuggestionForm() {
            document.getElementById('addSuggestionModal').classList.remove('hidden');
        }
        
        function hideAddSuggestionForm() {
            document.getElementById('addSuggestionModal').classList.add('hidden');
            const form = document.getElementById('addSuggestionForm');
            if (form) {
                form.reset();
                form.removeAttribute('data-edit-id');
                document.querySelector('#addSuggestionModal h3').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯';
            }
        }
        
        function submitSuggestion() {
            const form = document.getElementById('addSuggestionForm');
            const formData = new FormData(form);
            const editId = form.getAttribute('data-edit-id');
            
            const suggestionData = {
                title: formData.get('title'),
                description: formData.get('description'),
                category: formData.get('category'),
                submitted_by: formData.get('submitted_by')
            };
            
            if (editId) {
                let suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]');
                const index = suggestions.findIndex(s => s.id === editId);
                if (index !== -1) {
                    suggestions[index] = { ...suggestions[index], ...suggestionData };
                    localStorage.setItem('suggestions', JSON.stringify(suggestions));
                }
            } else {
                if (app) app.addSuggestion(suggestionData);
            }
            
            if (app) app.displaySuggestions();
            hideAddSuggestionForm();
            showNotification('ØªÙ… ' + (editId ? 'ØªØ­Ø¯ÙŠØ«' : 'Ø¥Ø¶Ø§ÙØ©') + ' Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }
        
        function editSuggestion(suggestionId) {
            const suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]');
            const suggestion = suggestions.find(s => s.id === suggestionId);
            if (!suggestion) return;
            
            const form = document.getElementById('addSuggestionForm');
            form.title.value = suggestion.title;
            form.description.value = suggestion.description;
            form.category.value = suggestion.category;
            form.submitted_by.value = suggestion.submitted_by;
            
            form.setAttribute('data-edit-id', suggestionId);
            document.getElementById('addSuggestionModal').classList.remove('hidden');
            document.querySelector('#addSuggestionModal h3').textContent = 'ØªØ­Ø±ÙŠØ± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­';
        }
        
        function deleteSuggestion(suggestionId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ØŸ')) {
                let suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]');
                suggestions = suggestions.filter(s => s.id !== suggestionId);
                localStorage.setItem('suggestions', JSON.stringify(suggestions));
                if (app) app.displaySuggestions();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }
        }
        
        function voteSuggestion(suggestionId, voteType) {
            let suggestions = JSON.parse(localStorage.getItem('suggestions') || '[]');
            const suggestion = suggestions.find(s => s.id === suggestionId);
            if (!suggestion) return;
            
            if (voteType === 'up') {
                suggestion.upvotes = (suggestion.upvotes || 0) + 1;
            } else if (voteType === 'down') {
                suggestion.downvotes = (suggestion.downvotes || 0) + 1;
            }
            
            localStorage.setItem('suggestions', JSON.stringify(suggestions));
            if (app) app.displaySuggestions();
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØªØµÙˆÙŠØªÙƒ!', 'success');
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø©
        function showAddLibraryForm() {
            document.getElementById('addLibraryModal').classList.remove('hidden');
        }
        
        function hideAddLibraryForm() {
            document.getElementById('addLibraryModal').classList.add('hidden');
            const form = document.getElementById('addLibraryForm');
            if (form) {
                form.reset();
                form.removeAttribute('data-edit-id');
                document.querySelector('#addLibraryModal h3').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù„Ù„Ù…ÙƒØªØ¨Ø©';
            }
        }
        
        function submitLibraryItem() {
            const form = document.getElementById('addLibraryForm');
            const formData = new FormData(form);
            const editId = form.getAttribute('data-edit-id');
            
            const itemData = {
                title: formData.get('title'),
                description: formData.get('description'),
                category: formData.get('category'),
                type: formData.get('type'),
                author: formData.get('author'),
                tags: formData.get('tags'),
                file_url: formData.get('file_url')
            };
            
            if (editId) {
                let library = JSON.parse(localStorage.getItem('library') || '[]');
                const index = library.findIndex(i => i.id === editId);
                if (index !== -1) {
                    library[index] = { ...library[index], ...itemData, tags: itemData.tags ? itemData.tags.split(',').map(tag => tag.trim()) : [] };
                    localStorage.setItem('library', JSON.stringify(library));
                }
            } else {
                if (app) app.addLibraryItem(itemData);
            }
            
            if (app) app.displayLibrary();
            hideAddLibraryForm();
            showNotification('ØªÙ… ' + (editId ? 'ØªØ­Ø¯ÙŠØ«' : 'Ø¥Ø¶Ø§ÙØ©') + ' Ø¹Ù†ØµØ± Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }
        
        function editLibraryItem(itemId) {
            const library = JSON.parse(localStorage.getItem('library') || '[]');
            const item = library.find(i => i.id === itemId);
            if (!item) return;
            
            const form = document.getElementById('addLibraryForm');
            form.title.value = item.title;
            form.description.value = item.description;
            form.category.value = item.category;
            form.type.value = item.type;
            form.author.value = item.author;
            form.tags.value = item.tags ? item.tags.join(', ') : '';
            form.file_url.value = item.file_url || '';
            
            form.setAttribute('data-edit-id', itemId);
            document.getElementById('addLibraryModal').classList.remove('hidden');
            document.querySelector('#addLibraryModal h3').textContent = 'ØªØ­Ø±ÙŠØ± Ø¹Ù†ØµØ± Ø§Ù„Ù…ÙƒØªØ¨Ø©';
        }
        
        function deleteLibraryItem(itemId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ')) {
                let library = JSON.parse(localStorage.getItem('library') || '[]');
                library = library.filter(i => i.id !== itemId);
                localStorage.setItem('library', JSON.stringify(library));
                if (app) app.displayLibrary();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="mr-2 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 3000);
        }
        
    </script>
    
    <!-- Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
    <div id="addEventModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</h3>
                <button onclick="hideAddEventForm()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="addEventForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø¯Ø« *</label>
                        <input type="text" name="title" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø« *</label>
                        <select name="type" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø« --</option>
                            <option value="Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹Ø§Ø¦Ù„ÙŠØ©">Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹Ø§Ø¦Ù„ÙŠØ©</option>
                            <option value="Ø§Ø¬ØªÙ…Ø§Ø¹">Ø§Ø¬ØªÙ…Ø§Ø¹</option>
                            <option value="Ø§Ø­ØªÙØ§Ù„">Ø§Ø­ØªÙØ§Ù„</option>
                            <option value="Ø±Ø­Ù„Ø©">Ø±Ø­Ù„Ø©</option>
                            <option value="Ù…Ø¤ØªÙ…Ø±">Ù…Ø¤ØªÙ…Ø±</option>
                            <option value="ÙˆØ±Ø´Ø© Ø¹Ù…Ù„">ÙˆØ±Ø´Ø© Ø¹Ù…Ù„</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø« *</label>
                    <textarea name="description" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯Ø« *</label>
                        <input type="date" name="date" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆÙ‚Øª Ø§Ù„Ø­Ø¯Ø«</label>
                        <input type="time" name="time" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù…ÙƒØ§Ù† Ø§Ù„Ø­Ø¯Ø« *</label>
                        <input type="text" name="location" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¯Ø«</label>
                        <select name="status" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="upcoming">Ù‚Ø§Ø¯Ù…</option>
                            <option value="past">Ø§Ù†ØªÙ‡Ù‰</option>
                            <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4 rtl:space-x-reverse pt-4">
                    <button type="button" onclick="hideAddEventForm()" class="px-6 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="button" onclick="submitEvent()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Ø­ÙØ¸ Ø§Ù„Ø­Ø¯Ø«
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª -->
    <div id="addSuggestionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯</h3>
                <button onclick="hideAddSuggestionForm()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="addSuggestionForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ *</label>
                        <input type="text" name="title" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÙØ¦Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ *</label>
                        <select name="category" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© --</option>
                            <option value="ØªØ­Ø³ÙŠÙ†">ØªØ­Ø³ÙŠÙ†</option>
                            <option value="ÙØ¹Ø§Ù„ÙŠØ©">ÙØ¹Ø§Ù„ÙŠØ©</option>
                            <option value="Ø®Ø¯Ù…Ø©">Ø®Ø¯Ù…Ø©</option>
                            <option value="Ù…Ø´Ø±ÙˆØ¹">Ù…Ø´Ø±ÙˆØ¹</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ *</label>
                    <textarea name="description" rows="5" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ø§Ø´Ø±Ø­ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ *</label>
                    <input type="text" name="submitted_by" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div class="flex justify-end space-x-4 rtl:space-x-reverse pt-4">
                    <button type="button" onclick="hideAddSuggestionForm()" class="px-6 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="button" onclick="submitSuggestion()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
    <div id="addLibraryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù„Ù„Ù…ÙƒØªØ¨Ø©</h3>
                <button onclick="hideAddLibraryForm()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="addLibraryForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                        <input type="text" name="title" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÙØ¦Ø© Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                        <select name="category" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© --</option>
                            <option value="ÙƒØªØ§Ø¨">ÙƒØªØ§Ø¨</option>
                            <option value="Ù…Ù‚Ø§Ù„">Ù…Ù‚Ø§Ù„</option>
                            <option value="Ø¨Ø­Ø«">Ø¨Ø­Ø«</option>
                            <option value="ÙˆØ«ÙŠÙ‚Ø©">ÙˆØ«ÙŠÙ‚Ø©</option>
                            <option value="ØµÙˆØ±Ø©">ØµÙˆØ±Ø©</option>
                            <option value="ÙÙŠØ¯ÙŠÙˆ">ÙÙŠØ¯ÙŠÙˆ</option>
                            <option value="ØµÙˆØª">ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù *</label>
                        <select name="type" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù --</option>
                            <option value="pdf">PDF</option>
                            <option value="doc">Word Document</option>
                            <option value="image">ØµÙˆØ±Ø©</option>
                            <option value="video">ÙÙŠØ¯ÙŠÙˆ</option>
                            <option value="audio">Ù…Ù„Ù ØµÙˆØªÙŠ</option>
                            <option value="book">ÙƒØªØ§Ø¨</option>
                            <option value="article">Ù…Ù‚Ø§Ù„</option>
                            <option value="research">Ø¨Ø­Ø«</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù *</label>
                        <input type="text" name="author" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                    <textarea name="description" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù…Ø®ØªØµØ±Ø§Ù‹ Ù„Ù„Ù…Ø§Ø¯Ø©..."></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="url" name="file_url" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="https://example.com/file.pdf">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="text" name="tags" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ø¹Ù„Ø§Ù…Ø©1, Ø¹Ù„Ø§Ù…Ø©2, Ø¹Ù„Ø§Ù…Ø©3">
                    <p class="text-sm text-gray-500 mt-1">Ø§ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø¨ÙØ§ØµÙ„Ø©</p>
                </div>
                
                <div class="flex justify-end space-x-4 rtl:space-x-reverse pt-4">
                    <button type="button" onclick="hideAddLibraryForm()" class="px-6 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="button" onclick="submitLibraryItem()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ØµØ±
                    </button>
                </div>
            </form>
        </div>
    </div>
    
</body>
</html>