<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© - Ø¹Ø§Ø¦Ù„Ø© Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        .sync-status { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
                ğŸ  Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ø§Ø¦Ù„Ø© Ø¨Ù† Ø³Ø¹ÙŠØ¯Ø§Ù†
            </h1>
            
            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div id="syncStatus" class="text-center text-blue-700 font-medium"></div>
            </div>
            
            <!-- Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯ -->
            <div class="mb-6">
                <h2 class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</h2>
                <div class="flex gap-4">
                    <input type="text" id="memberName" class="flex-1 p-3 border rounded-lg" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                    <button onclick="addMember()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                        Ø¥Ø¶Ø§ÙØ©
                    </button>
                </div>
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ -->
            <div class="mb-6">
                <h2 class="text-xl font-bold mb-4">Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© (<span id="memberCount">0</span>)</h2>
                <div id="membersList" class="space-y-2"></div>
            </div>
            
            <!-- Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
            <div class="flex gap-4 justify-center">
                <button onclick="clearAllData()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                    Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="forceSync()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                    Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¨Ø³Ø·
        class SyncDemo {
            constructor() {
                this.localKey = 'saedan_family_demo_local';
                this.centralKey = 'saedan_family_demo_central';
                this.data = this.loadLocal() || { members: [], version: 0 };
                this.syncInterval = null;
                
                this.render();
                this.startAutoSync();
                this.showSyncStatus('Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'info');
            }
            
            loadLocal() {
                const stored = localStorage.getItem(this.localKey);
                return stored ? JSON.parse(stored) : null;
            }
            
            saveLocal() {
                localStorage.setItem(this.localKey, JSON.stringify(this.data));
            }
            
            loadCentral() {
                const stored = localStorage.getItem(this.centralKey);
                return stored ? JSON.parse(stored) : null;
            }
            
            saveCentral() {
                localStorage.setItem(this.centralKey, JSON.stringify(this.data));
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ÙƒØ²ÙŠØ§Ù‹:', this.data.members.length, 'Ø¹Ø¶Ùˆ');
            }
            
            addMember(name) {
                if (!name.trim()) return;
                
                const member = {
                    id: Date.now(),
                    name: name.trim(),
                    addedAt: new Date().toLocaleString('ar-SA')
                };
                
                this.data.members.push(member);
                this.data.version++;
                this.data.lastUpdated = new Date().toISOString();
                
                this.saveLocal();
                this.saveCentral();
                this.render();
                
                this.showSyncStatus(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${name}" ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`, 'success');
                
                return member;
            }
            
            sync() {
                const central = this.loadCentral();
                
                if (!central) {
                    console.log('ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ù…Ø±ÙƒØ²');
                    this.saveCentral();
                    this.showSyncStatus('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø±ÙƒØ²', 'success');
                    return;
                }
                
                if (central.version > this.data.version) {
                    console.log('ğŸ“¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²');
                    this.data = central;
                    this.saveLocal();
                    this.render();
                    this.showSyncStatus('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±!', 'update');
                } else if (this.data.version > central.version) {
                    console.log('ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ù„Ù…Ø±ÙƒØ²');
                    this.saveCentral();
                    this.showSyncStatus('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù„Ù„Ù…Ø±ÙƒØ²', 'success');
                } else {
                    console.log('âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©');
                }
            }
            
            startAutoSync() {
                this.syncInterval = setInterval(() => {
                    this.sync();
                }, 3000); // ÙƒÙ„ 3 Ø«ÙˆØ§Ù† Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹
            }
            
            render() {
                const membersList = document.getElementById('membersList');
                const memberCount = document.getElementById('memberCount');
                
                memberCount.textContent = this.data.members.length;
                
                if (this.data.members.length === 0) {
                    membersList.innerHTML = '<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø¹Ø¯</p>';
                    return;
                }
                
                membersList.innerHTML = this.data.members.map(member => `
                    <div class="bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                        <div>
                            <span class="font-medium">${member.name}</span>
                            <span class="text-sm text-gray-500 mr-2">- ${member.addedAt}</span>
                        </div>
                        <button onclick="syncDemo.removeMember(${member.id})" class="text-red-600 hover:text-red-800">
                            Ø­Ø°Ù
                        </button>
                    </div>
                `).join('');
            }
            
            removeMember(id) {
                this.data.members = this.data.members.filter(m => m.id !== id);
                this.data.version++;
                this.data.lastUpdated = new Date().toISOString();
                
                this.saveLocal();
                this.saveCentral();
                this.render();
                this.showSyncStatus('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            }
            
            clearAll() {
                this.data = { members: [], version: 0 };
                this.saveLocal();
                this.saveCentral();
                this.render();
                this.showSyncStatus('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
            }
            
            showSyncStatus(message, type = 'info') {
                const statusEl = document.getElementById('syncStatus');
                
                let icon = 'ğŸ”„';
                let color = 'text-blue-700';
                
                switch (type) {
                    case 'success':
                        icon = 'âœ…';
                        color = 'text-green-700';
                        break;
                    case 'update':
                        icon = 'ğŸ”„';
                        color = 'text-purple-700';
                        break;
                    case 'warning':
                        icon = 'âš ï¸';
                        color = 'text-orange-700';
                        break;
                    case 'error':
                        icon = 'âŒ';
                        color = 'text-red-700';
                        break;
                }
                
                statusEl.innerHTML = `<span class="${color}">${icon} ${message}</span>`;
                
                setTimeout(() => {
                    statusEl.innerHTML = '<span class="text-gray-500">ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ 3 Ø«ÙˆØ§Ù†</span>';
                }, 3000);
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¶
        let syncDemo;
        
        window.onload = function() {
            syncDemo = new SyncDemo();
        };
        
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        function addMember() {
            const input = document.getElementById('memberName');
            const name = input.value;
            if (name.trim()) {
                syncDemo.addMember(name);
                input.value = '';
            }
        }
        
        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                syncDemo.clearAll();
            }
        }
        
        function forceSync() {
            syncDemo.sync();
            syncDemo.showSyncStatus('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©', 'info');
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id === 'memberName') {
                addMember();
            }
        });
    </script>
</body>
</html>